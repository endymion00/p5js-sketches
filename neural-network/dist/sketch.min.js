/**
 * Something Like Neural Network.
 * Website => https://www.fal-works.com/
 * Including module: p5ex (Copyright 2018 FAL, licensed under MIT).
 * @copyright 2018 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.0
 * @license CC-BY-SA-3.0
 */
!function(){"use strict";class t{}class e extends t{get width(){return this.rightPositionX-this.leftPositionX}get height(){return this.bottomPositionY-this.topPositionY}get area(){return this.width*this.height}constructor(t,e,i,s,o=0){super(),this.leftPositionX=t-o,this.topPositionY=e-o,this.rightPositionX=i+o,this.bottomPositionY=s+o}contains(t,e=0){return t.x>=this.leftPositionX-e&&t.x<=this.rightPositionX+e&&t.y>=this.topPositionY-e&&t.y<=this.bottomPositionY+e}constrain(t,e=0){t.x<this.leftPositionX-e?t.x=this.leftPositionX-e:t.x>this.rightPositionX+e&&(t.x=this.rightPositionX+e),t.y<this.topPositionY-e?t.y=this.topPositionY-e:t.y>this.bottomPositionY+e&&(t.y=this.bottomPositionY+e)}}class i{constructor(t,i,s,o){this.p=t,this.canvasElement=t.createCanvas(i.scaledWidth,i.scaledHeight,o),this.canvasElement&&"parent"in this.canvasElement&&this.canvasElement.parent(s),this.region=new e(0,0,0,0),this.nonScaledShortSideLength=i.nonScaledShortSideLength,this.updateSize()}get scaleFactor(){return this._scaleFactor}get nonScaledWidth(){return this._nonScaledWidth}get nonScaledHeight(){return this._nonScaledHeight}get aspectRatio(){return this._aspectRatio}resize(t){this.p.resizeCanvas(t.scaledWidth,t.scaledHeight),this.nonScaledShortSideLength=t.nonScaledShortSideLength,this.updateSize()}updateSize(){const t=this.p;this._scaleFactor=Math.min(t.width,t.height)/this.nonScaledShortSideLength,this._inversedScaleFactor=1/this._scaleFactor,this._nonScaledWidth=t.width/this._scaleFactor,this._nonScaledHeight=t.height/this._scaleFactor,this._aspectRatio=t.width/t.height,this.region.rightPositionX=this._nonScaledWidth,this.region.bottomPositionY=this._nonScaledHeight}scale(){this.p.scale(this._scaleFactor)}cancelScale(){this.p.scale(this._inversedScaleFactor)}getNonScaledValueOf(t){return t/this._scaleFactor}}i.DUMMY_PARAMETERS={scaledWidth:100,scaledHeight:100,nonScaledShortSideLength:100};const s={SQUARE640x640:"SQUARE640x640",RECT640x480:"RECT640x480",FULL:"FULL",CUSTOM:"CUSTOM"};class o{constructor(t,e){this.p=t,this.p5Color=e}stroke(){this.p.currentRenderer.stroke(this.p5Color)}fill(){this.p.currentRenderer.fill(this.p5Color)}}class n{constructor(t){this.p=t}stroke(){this.p.currentRenderer.noStroke()}fill(){this.p.currentRenderer.noFill()}}class a{stroke(){}fill(){}}class r{constructor(t,e,i=256){this.p=t;const s=[];for(let o=0;o<i;o+=1)s.push(t.color(t.red(e),t.green(e),t.blue(e),t.alpha(e)*o/(i-1)));this.colorArray=s,this.maxIndex=i-1}stroke(t){this.p.currentRenderer.stroke(this.getColor(t))}fill(t){this.p.currentRenderer.fill(this.getColor(t))}getColor(t){return this.colorArray[t?Math.floor(this.p.map(t,0,255,0,this.maxIndex)):this.maxIndex]}}function h(t,e,i,s){return t&&void 0!==e?null===e?new n(t):i?new r(t,e,s):new o(t,e):new a}class c{constructor(t,e,i,s,o){this.strokeColor=h(t,e,s,o),this.fillColor=h(t,i,s,o)}applyColor(t){this.strokeColor.stroke(t),this.fillColor.fill(t)}}c.UNDEFINED=new c(void 0,void 0,void 0);Math.PI;const l=new p5(t=>{t.setup=(()=>{t.noCanvas()})});Math.PI,l.createVector(),l.createVector();class p{constructor(t=256){this.array=new Array(t),this.length=0}get(t){return this.array[t]}getLast(){return this.array[this.length-1]}push(t){return this.array[this.length]=t,this.length+=1,this.length}pushRawArray(t,e=t.length){for(let i=0;i<e;i+=1)this.array[this.length+i]=t[i];return this.length+=e,this.length}pushAll(t){return this.pushRawArray(t.array,t.length)}pop(){return this.length-=1,this.array[this.length]}clear(){this.length=0}loop(t){!function(t,e,i){let s=0;for(;s<i;)e(t[s],s,t),s+=1}(this.array,t,this.length)}loopBackwards(t){!function(t,e,i){for(;i--;)e(t[i],i,t)}(this.array,t,this.length)}roundRobin(t){!function(t,e,i){for(let s=0,o=i-1;s<o;s+=1)for(let n=s+1;n<i;n+=1)e(t[s],t[n])}(this.array,t,this.length)}nestedLoopJoin(t,e){!function(t,e,i,s,o){for(let n=0;n<s;n+=1)for(let s=0;s<o;s+=1)i(t[n],e[s])}(this.array,t.array,e,this.length,t.length)}}class d extends p{static drawFunction(t){t.draw()}draw(){this.loop(d.drawFunction)}}class u extends p{static stepFunction(t){t.step()}step(){this.loop(u.stepFunction)}}class g extends p{}g.prototype.step=u.prototype.step,g.prototype.draw=d.prototype.draw;class y extends p{constructor(t){super(t),this.recentRemovedElements=new p(t)}clean(){this.recentRemovedElements.clear();let t=0;for(let e=0;e<this.length;e+=1)this.array[e].clean(),this.array[e].isToBeRemoved?this.recentRemovedElements.push(this.array[e]):(this.array[t]=this.array[e],t+=1);this.length=t}}class w extends y{}w.prototype.draw=g.prototype.draw,w.prototype.step=g.prototype.step;l.createVector(),l.createVector(),l.createVector();class S{constructor(t,e,i){this.p=t,this.width=e,this.height=i,this.isToBeRemoved=!1}static updateSizeRatio(t){S.sizeRatio=1+.1*Math.sin(2*Math.PI*(t%60)/60)}step(){}clean(){this.position.y<-20&&(this.isToBeRemoved=!0)}draw(){this.p.rectMode(this.p.CENTER),this.shapeColor.applyColor(),this.p.rect(this.position.x,this.position.y,S.sizeRatio*this.width,S.sizeRatio*this.height,2)}}S.sizeRatio=1;class f extends S{constructor(t,e,i){super(t,16,16),this.p=t,this.position=t.createVector(e,i),this.velocity=p5.Vector.random2D().mult(3*Math.random()),this.shapeColor=new c(t,null,t.color(192,192,255),!1)}step(){super.step(),this.position.add(this.velocity),this.width*=.95,this.height*=.95,this.velocity.y+=.1,this.width<1.5&&(this.isToBeRemoved=!0)}}class m{constructor(t,e,i){this.p=t,this.lastInput1=0,this.lastInput2=0,this.currentOutput=0,this.idealInput1=0,this.idealInput2=0,this.weight1=.7*t.random(-1,1),this.weight2=.7*t.random(-1,1),this.position=t.createVector(e,i)}feedForward(t,e){this.lastInput1=t,this.lastInput2=e,this.currentOutput=t*this.weight1+e*this.weight2>0?1:-1}feedBack(t){const e=t-this.currentOutput;this.weight1=this.p.constrain(this.weight1+e*this.lastInput1*5e-4,-1,1),this.weight2=this.p.constrain(this.weight2+e*this.lastInput2*5e-4,-1,1),this.idealInput1=t*this.weight1,this.idealInput2=t*this.weight2}}var x;new class extends p5{setCurrentRenderer(t){this.currentRenderer=t}get nonScaledWidth(){return this.scalableCanvas.nonScaledWidth}get nonScaledHeight(){return this.scalableCanvas.nonScaledHeight}get idealFrameRate(){return this._idealFrameRate}get unitAngleSpeed(){return this._unitAngleSpeed}get unitSpeed(){return this._unitSpeed}get unitAccelerationMagnitude(){return this._unitAccelerationMagnitude}constructor(t,e,i){super(t,"string"==typeof e?document.getElementById(e)||void 0:e,i),this.node=e&&"boolean"!=typeof e?"string"==typeof e?document.getElementById(e)||document.body:e:document.body,this.currentRenderer=this,this.maxCanvasRegion={width:0,height:0,getShortSideLength(){return Math.min(this.width,this.height)}},this.updateMaxCanvasRegion(),this.setFrameRate()}setFrameRate(t=60){return this.frameRate(t),t&&(this._idealFrameRate=t,this._unitAngleSpeed=2*Math.PI/this._idealFrameRate,this._unitSpeed=1/this._idealFrameRate,this._unitAccelerationMagnitude=this._unitSpeed/this._idealFrameRate),this}updateMaxCanvasRegion(){if(this.maxCanvasRegion.width=this.windowWidth,this.maxCanvasRegion.height=this.windowHeight,this.node===document.body)return;const t=this.node.getBoundingClientRect();this.maxCanvasRegion.width=t.width,this.maxCanvasRegion.height=t.height}createScalableCanvas(t,e,s){this.scalableCanvasType=t,this.scalableCanvas=new i(this,this.createScalableCanvasParameter(t,e),this.node,s)}resizeScalableCanvas(t,e){this.scalableCanvas.resize(this.createScalableCanvasParameter(t||this.scalableCanvasType,e))}createScalableCanvasParameter(t,e){this.updateMaxCanvasRegion();const o=this.maxCanvasRegion.getShortSideLength();switch(t){case s.SQUARE640x640:return{scaledWidth:o,scaledHeight:o,nonScaledShortSideLength:640};case s.RECT640x480:return{scaledWidth:o,scaledHeight:.75*o,nonScaledShortSideLength:480};case s.FULL:return{scaledWidth:this.maxCanvasRegion.width,scaledHeight:this.maxCanvasRegion.height,nonScaledShortSideLength:640};default:return e||i.DUMMY_PARAMETERS}}}(t=>{let e,i,o,n,a,r,h,l,p,d,u,g,y,x,R,v,C=0;function F(e,i){t.line(e.position.x,e.position.y,i.position.x,i.position.y)}function P(){r=new m(t,180,430),h=new m(t,180,550),l=new m(t,320,430),p=new m(t,320,550),d=new m(t,450,430),u=new m(t,450,550),g=[r,h,l,p,d,u]}t.preload=(()=>{}),t.setup=(()=>{t.createScalableCanvas(s.SQUARE640x640),e=new class extends S{constructor(t){super(t,32,32),this.p=t,this.velocityX=0,this.position=t.createVector(320,320),this.shapeColor=new c(t,null,t.color(32,32,48))}step(){super.step(),this.position.x+=this.velocityX,this.position.x<16?(this.position.x=16,this.velocityX*=-1):this.position.x>624&&(this.position.x=624,this.velocityX*=-1),this.velocityX*=.9}applyForce(t){this.velocityX=this.p.constrain(this.velocityX+.5*t,-20,20)}}(t),i=new w,o=new w,n=new w,a=function(e,i){if(Math.abs(e.position.x-i.position.x)<20&&Math.abs(e.position.y-i.position.y)<32){e.isToBeRemoved=!0,i.isToBeRemoved=!0;for(let e=0;e<16;e+=1)n.push(new f(t,i.position.x,i.position.y))}},P(),t.textFont("Courier New",12),t.textStyle(t.BOLD),x=t.color(96,96,128),y=t.color(248,248,252),R=new c(t,x,y),v=new c(t,null,x)}),t.draw=(()=>{t.background(y),t.scalableCanvas.scale(),t.frameCount%60==0&&i.push(new class extends S{constructor(t){super(t,32,32),this.p=t,this.position=t.createVector(320+160*t.random(-1,1),0),this.shapeColor=new c(t,null,t.color(32,32,160))}step(){super.step(),this.position.y+=1,this.position.y>280&&(this.isToBeRemoved=!0)}}(t)),t.frameCount%6==0&&o.push(new class extends S{constructor(t,e){super(t,8,24),this.p=t,this.position=t.createVector(e,320),this.shapeColor=new c(t,null,t.color(48,48,64))}step(){super.step(),this.position.y-=10}}(t,e.position.x)),e.step(),i.step(),o.step(),n.step(),o.clean(),o.nestedLoopJoin(i,a),i.clean(),n.clean(),S.updateSizeRatio(t.frameCount),n.draw(),e.draw(),i.draw(),o.draw(),function(){const t=0===i.length?320:i.get(0).position.x;C=t-e.position.x,r.feedForward(C,e.velocityX),h.feedForward(C,e.velocityX),l.feedForward(r.currentOutput,h.currentOutput),p.feedForward(r.currentOutput,h.currentOutput),d.feedForward(l.currentOutput,p.currentOutput),u.feedForward(l.currentOutput,p.currentOutput),d.currentOutput>0&&e.applyForce(-1),u.currentOutput>0&&e.applyForce(1);const s=C-10*e.velocityX;d.feedBack(s<0?1:-1),u.feedBack(s>0?1:-1),l.feedBack(d.idealInput1),l.feedBack(u.idealInput1),p.feedBack(d.idealInput2),p.feedBack(u.idealInput2),r.feedBack(l.idealInput1),r.feedBack(p.idealInput1),h.feedBack(l.idealInput2),h.feedBack(p.idealInput2)}(),function(){t.stroke(x),F(r,l),F(r,p),F(h,l),F(h,p),F(l,d),F(l,u),F(p,d),F(p,u);for(const e of g){R.applyColor(),t.ellipse(e.position.x,e.position.y,80,80),v.applyColor();const i=Math.round(1e4*e.weight1)/1e4,s=Math.round(1e4*e.weight2)/1e4;t.text((i>=0?" ":"")+t.nf(i,1,4),e.position.x-27,e.position.y-8),t.text((s>=0?" ":"")+t.nf(s,1,4),e.position.x-27,e.position.y+13)}v.applyColor();const i=Math.round(100*C)/100;t.text(`Pos. diff.: ${(i>=0?" ":"")+t.nf(i,3,2)}`,20,(r.position.y+h.position.y)/2-8);const s=Math.round(100*e.velocityX)/100;t.text(`Velocity: ${(s>=0?" ":"")+t.nf(s,2,2)}`,20,(r.position.y+h.position.y)/2+13);const o=d.currentOutput>0?"Y":"N";t.text(`Go left: ${o}`,d.position.x+60,d.position.y);const n=u.currentOutput>0?"Y":"N";t.text(`Go right: ${n}`,u.position.x+60,u.position.y)}(),t.scalableCanvas.cancelScale()}),t.windowResized=(()=>{}),t.mousePressed=(()=>{(t=t).mouseX<0||t.mouseX>t.width||t.mouseY<0||t.mouseY>t.height||P()}),t.keyTyped=(()=>{})},"SomethingLikeNeuralNetwork")}();