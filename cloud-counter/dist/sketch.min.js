/**
 * Cloud Counter.
 * Website => https://www.fal-works.com/
 * @copyright 2019 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.0
 * @license CC-BY-SA-3.0
 */
!function(){"use strict";const e=e=>document.getElementById(e)||document.body,t=e=>e===document.body?{width:window.innerWidth,height:window.innerHeight}:e.getBoundingClientRect();var n,o;(o=n||(n={})).FIT_TO_BOX="FIT_TO_BOX",o.FIT_WIDTH="FIT_WIDTH",o.FIT_HEIGHT="FIT_HEIGHT";const c=(e,t,n)=>{switch(n){default:case"FIT_TO_BOX":return Math.min(t.width/e.width,t.height/e.height);case"FIT_WIDTH":return t.width/e.width;case"FIT_HEIGHT":return t.height/e.height}};function s(e,t,n,o){e.translate(n,o),t(e),e.translate(-n,-o)}const i=e("CloudCounter");var a,r;new p5(n=>{const o=12;let d,l,h;const u=[];let p,T=0,g=0,f=-1,w=!1,I=!1;const S=e=>e*e;function F(e,t){const c=(n.atan2(t,e)+n.TWO_PI)%n.TWO_PI,s=-d.nonScaledSize.width/2+e/d.scaleFactor,i=-d.nonScaledSize.height/2+t/d.scaleFactor,a=S(s)+S(i),r=Math.floor(c/(n.TWO_PI/o));return a<=u[r].magSq()}function m(e){e.beginShape();const t=u.length,n=t+3;for(let o=0;o<n;o+=1){const n=u[o%t];e.curveVertex(n.x,n.y)}e.endShape()}function _(e){e.text(f,0,0)}function x(){f+=1,T=1;const e=new XMLHttpRequest;e.open("GET","https://cloud-counter.herokuapp.com/increment",!0),e.responseType="json",e.onload=function(){const t=e.response;t.count>f&&(T=1,f=t.count)},e.send()}function E(){let e=0,t=0;T>.01&&(e=T*n.random(-1,1)*d.nonScaledSize.width*.1,t=T*n.random(-1,1)*d.nonScaledSize.height*.1),n.noStroke(),n.fill(p),I?(n.textFont("Impact",64),s(n,_,T*e,T*t),n.textFont("Verdana",24),n.text(`Clicked ${f} times around the world.`,0,.4*d.nonScaledSize.height)):(n.textFont("Verdana",24),n.text("Connecting.\nPlease wait a few seconds...",0,0)),I&&(w||(n.stroke(p),n.noFill()),s(n,m,e,t))}n.preload=(()=>{}),n.setup=(()=>{d=function(n,o,s,i,a){const r=t("string"==typeof o?e(o):o),d=c(s,r,i);return{p5Canvas:n.createCanvas(d*s.width,d*s.height,a),scaleFactor:d,nonScaledSize:s,drawScaled:e=>(l=n,h=e,u=d,l.scale(u),h(l),void l.scale(1/u))};var l,h,u}(n,i,{width:800,height:800}),h=n.color(252,252,255),r=(e=>{e.background(h)}),(a=n).push(),r(a),a.pop(),a.loadPixels(),l=a.pixels,p=n.color(255,255,240),n.noStroke(),n.fill(p),n.blendMode(n.DIFFERENCE),n.strokeWeight(2),n.textAlign(n.CENTER,n.CENTER),function(){for(let e=0;e<o;e+=1)u.push(n.createVector())}(),function(){const e=new XMLHttpRequest;e.open("GET","https://cloud-counter.herokuapp.com/",!0),e.responseType="json",e.onload=function(){const t=e.response;f!=t.count&&(f=t.count,T=1),I=!0},e.send()}()}),n.draw=(()=>{n.pixels=l,n.updatePixels(),function(e,t){for(let c=0;c<o;c+=1){const s=c*n.TWO_PI/o,i=t*(1+1*n.noise(.5*c,g));e[c].set(i*Math.cos(s),i*Math.sin(s))}}(u,100*(1+S(T))),w=F(n.mouseX,n.mouseY),n.translate(.5*n.width,.45*n.height),d.drawScaled(E),g+=.01*(1+16*T),T*=.92}),n.mousePressed=(()=>{if(I)if(w)x();else if(null!=n.touches&&n.touches.length>0){const e=n.touches[0];F(e.x,e.y)&&x()}}),n.keyTyped=(()=>{"p"===n.key&&n.noLoop(),"s"===n.key&&n.save("image.png")})},i)}();