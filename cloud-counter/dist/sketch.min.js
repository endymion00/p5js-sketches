/**
 * Cloud Counter.
 * Website => https://www.fal-works.com/
 * @copyright 2019 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.0
 * @license CC-BY-SA-3.0
 */
!function(){"use strict";const e=e=>document.getElementById(e)||document.body,t=e=>e===document.body?{width:window.innerWidth,height:window.innerHeight}:e.getBoundingClientRect();var n,o;(o=n||(n={})).FIT_TO_BOX="FIT_TO_BOX",o.FIT_WIDTH="FIT_WIDTH",o.FIT_HEIGHT="FIT_HEIGHT";const c=(e,t,n)=>{switch(n){default:case"FIT_TO_BOX":return Math.min(t.width/e.width,t.height/e.height);case"FIT_WIDTH":return t.width/e.width;case"FIT_HEIGHT":return t.height/e.height}};function s(e,t,n,o){e.translate(n,o),t(e),e.translate(-n,-o)}const i=e("CloudCounter");var a,d;new p5(n=>{const o=12;let r,u,h;const l=[];let p,T=0,g=0,w=-1,f=!1,I=!1;const m=e=>e*e;function S(e,t){const c=(n.atan2(t,e)+n.TWO_PI)%n.TWO_PI,s=-r.nonScaledSize.width/2+e/r.scaleFactor,i=-r.nonScaledSize.height/2+t/r.scaleFactor,a=m(s)+m(i),d=Math.floor(c/(n.TWO_PI/o));return a<=l[d].magSq()}function F(e){e.beginShape();const t=l.length,n=t+3;for(let o=0;o<n;o+=1){const n=l[o%t];e.curveVertex(n.x,n.y)}e.endShape()}function _(e){e.text(w,0,0)}function E(){w+=1,T=1;const e=new XMLHttpRequest;e.open("GET","https://cloud-counter.herokuapp.com/increment",!0),e.responseType="json",e.onload=function(){const t=e.response;t.count>w&&(T=1,w=t.count)},e.send()}function x(){let e=0,t=0;T>.01&&(e=T*n.random(-1,1)*r.nonScaledSize.width*.1,t=T*n.random(-1,1)*r.nonScaledSize.height*.1),n.noStroke(),n.fill(p),I?(n.textFont("Impact",64),s(n,_,T*e,T*t),n.textFont("Verdana",24),n.text(`Clicked ${w} times around the world.`,0,.4*r.nonScaledSize.height)):(n.textFont("Verdana",24),n.text("Connecting.\nPlease wait a few seconds...",0,0)),I&&(f||(n.stroke(p),n.noFill()),s(n,F,e,t))}n.preload=(()=>{}),n.setup=(()=>{r=function(n,o,s,i,a){const d=t("string"==typeof o?e(o):o),r=c(s,d,i);return{p5Canvas:n.createCanvas(r*s.width,r*s.height,a),scaleFactor:r,nonScaledSize:s,drawScaled:e=>(u=n,h=e,l=r,u.scale(l),h(u),void u.scale(1/l))};var u,h,l}(n,i,{width:800,height:800}),h=n.color(252,252,255),d=(e=>{e.background(h)}),(a=n).push(),d(a),a.pop(),a.loadPixels(),u=a.pixels,p=n.color(255,255,240),n.noStroke(),n.fill(p),n.blendMode(n.DIFFERENCE),n.strokeWeight(2),n.textAlign(n.CENTER,n.CENTER),function(){for(let e=0;e<o;e+=1)l.push(n.createVector())}(),function(){const e=new XMLHttpRequest;e.open("GET","https://cloud-counter.herokuapp.com/",!0),e.responseType="json",e.onload=function(){const t=e.response;w!=t.count&&(w=t.count,T=1),I=!0},e.send()}()}),n.draw=(()=>{n.pixels=u,n.updatePixels(),function(e,t){for(let c=0;c<o;c+=1){const s=c*n.TWO_PI/o,i=t*(1+1*n.noise(.5*c,g));e[c].set(i*Math.cos(s),i*Math.sin(s))}}(l,100*(1+m(T))),n.translate(.5*n.width,.45*n.height),r.drawScaled(x),g+=.01*(1+16*T),T*=.92}),n.mousePressed=(()=>{I&&f&&E()}),n.mouseMoved=(()=>{f=S(n.mouseX,n.mouseY)}),n.touchStarted=(()=>{if(I)return S(n.mouseX,n.mouseY)?(f=!0,E(),!1):void 0}),n.touchMoved=(()=>{}),n.touchEnded=(()=>{f=!1}),n.keyTyped=(()=>{"p"===n.key&&n.noLoop(),"s"===n.key&&n.save("image.png")})},i)}();