/**
 * Cloud Counter.
 * Website => https://www.fal-works.com/
 * @copyright 2019 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.0
 * @license CC-BY-SA-3.0
 */
!function(){"use strict";const e=e=>document.getElementById(e)||document.body,t=e=>e===document.body?{width:window.innerWidth,height:window.innerHeight}:e.getBoundingClientRect();var n,o;(o=n||(n={})).FIT_TO_BOX="FIT_TO_BOX",o.FIT_WIDTH="FIT_WIDTH",o.FIT_HEIGHT="FIT_HEIGHT";const s=(e,t,n)=>{switch(n){default:case"FIT_TO_BOX":return Math.min(t.width/e.width,t.height/e.height);case"FIT_WIDTH":return t.width/e.width;case"FIT_HEIGHT":return t.height/e.height}};function c(e,t,n,o){e.translate(n,o),t(e),e.translate(-n,-o)}const i=e("CloudCounter");var a,d;new p5(n=>{const o=12;let r,u,h;const l=[];let p,T=0,m=0,g=-1,f=!1,w=!1;const I=e=>e*e;function S(e,t){const s=(n.atan2(t,e)+n.TWO_PI)%n.TWO_PI,c=-r.nonScaledSize.width/2+e/r.scaleFactor,i=-r.nonScaledSize.height/2+t/r.scaleFactor,a=I(c)+I(i),d=Math.floor(s/(n.TWO_PI/o));return a<=l[d].magSq()}function F(e){e.beginShape();const t=l.length,n=t+3;for(let o=0;o<n;o+=1){const n=l[o%t];e.curveVertex(n.x,n.y)}e.endShape()}function _(e){e.text(g,0,0)}function E(){const e=new XMLHttpRequest;e.open("GET","https://cloud-counter.herokuapp.com/",!0),e.responseType="json",e.onload=function(){const t=e.response;t.count>g&&(T=1),g=t.count,w=!0},e.send()}function x(){g+=1,T=1;const e=new XMLHttpRequest;e.open("GET","https://cloud-counter.herokuapp.com/increment",!0),e.responseType="json",e.onload=function(){const t=e.response;t.count>g&&(T=1),g=t.count},e.send()}function H(){let e=0,t=0;T>.01&&(e=T*n.random(-1,1)*r.nonScaledSize.width*.1,t=T*n.random(-1,1)*r.nonScaledSize.height*.1),n.noStroke(),n.fill(p),w?(n.textFont("Impact",64),c(n,_,T*e,T*t),n.textFont("Verdana",24),n.text(`Clicked ${g} times around the world.`,0,.4*r.nonScaledSize.height)):(n.textFont("Verdana",24),n.text("Connecting.\nPlease wait a few seconds...",0,0)),w&&(f||(n.stroke(p),n.noFill()),c(n,F,e,t))}n.preload=(()=>{}),n.setup=(()=>{r=function(n,o,c,i,a){const d=t("string"==typeof o?e(o):o),r=s(c,d,i);return{p5Canvas:n.createCanvas(r*c.width,r*c.height,a),scaleFactor:r,nonScaledSize:c,drawScaled:e=>(u=n,h=e,l=r,u.scale(l),h(u),void u.scale(1/l))};var u,h,l}(n,i,{width:800,height:800}),h=n.color(252,252,255),d=(e=>{e.background(h)}),(a=n).push(),d(a),a.pop(),a.loadPixels(),u=a.pixels,p=n.color(255,255,240),n.noStroke(),n.fill(p),n.blendMode(n.DIFFERENCE),n.strokeWeight(2),n.textAlign(n.CENTER,n.CENTER),function(){for(let e=0;e<o;e+=1)l.push(n.createVector())}(),E()}),n.draw=(()=>{n.pixels=u,n.updatePixels(),function(e,t){for(let s=0;s<o;s+=1){const c=s*n.TWO_PI/o,i=t*(1+1*n.noise(.5*s,m));e[s].set(i*Math.cos(c),i*Math.sin(c))}}(l,100*(1+I(T))),n.translate(.5*n.width,.45*n.height),r.drawScaled(H),m+=.01*(1+16*T),T*=.92,n.frameCount%30==0&&E()}),n.mousePressed=(()=>{w&&(f=S(n.mouseX,n.mouseY))&&x()}),n.mouseMoved=(()=>{w&&(f=S(n.mouseX,n.mouseY))}),n.mouseReleased=(()=>{f=S(n.mouseX,n.mouseY)}),n.touchStarted=(()=>{if(w)return S(n.mouseX,n.mouseY)?(f=!0,x(),!1):void 0}),n.touchMoved=(()=>{}),n.touchEnded=(()=>{f=!1}),n.keyTyped=(()=>{"p"===n.key&&n.noLoop(),"s"===n.key&&n.save("image.png")})},i)}();