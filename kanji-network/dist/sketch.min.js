/**
 * Kanji Network.
 * Website => https://www.fal-works.com/
 * Including module: p5ex (Copyright 2018 FAL, licensed under MIT).
 * @copyright 2018 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.0
 * @license CC-BY-SA-3.0
 */
!function(){"use strict";class t{constructor(t,e,i,s){this.p=t,this.canvasElement=t.createCanvas(e.scaledWidth,e.scaledHeight,s),this.canvasElement&&"parent"in this.canvasElement&&this.canvasElement.parent(i),this.nonScaledShortSideLength=e.nonScaledShortSideLength,this.updateSize()}get scaleFactor(){return this._scaleFactor}get nonScaledWidth(){return this._nonScaledWidth}get nonScaledHeight(){return this._nonScaledHeight}get aspectRatio(){return this._aspectRatio}resize(t){this.p.resizeCanvas(t.scaledWidth,t.scaledHeight),this.nonScaledShortSideLength=t.nonScaledShortSideLength,this.updateSize()}updateSize(){const t=this.p;this._scaleFactor=Math.min(t.width,t.height)/this.nonScaledShortSideLength,this._inversedScaleFactor=1/this._scaleFactor,this._nonScaledWidth=t.width/this._scaleFactor,this._nonScaledHeight=t.height/this._scaleFactor,this._aspectRatio=t.width/t.height}scale(){this.p.scale(this._scaleFactor)}cancelScale(){this.p.scale(this._inversedScaleFactor)}getNonScaledValueOf(t){return t/this._scaleFactor}}t.DUMMY_PARAMETERS={scaledWidth:100,scaledHeight:100,nonScaledShortSideLength:100};const e={SQUARE640x640:"SQUARE640x640",RECT640x480:"RECT640x480",FULL:"FULL",CUSTOM:"CUSTOM"};class i{constructor(t,e){this.p=t,this.p5Color=e}stroke(){this.p.currentRenderer.stroke(this.p5Color)}fill(){this.p.currentRenderer.fill(this.p5Color)}}class s{constructor(t){this.p=t}stroke(){this.p.currentRenderer.noStroke()}fill(){this.p.currentRenderer.noFill()}}class o{stroke(){}fill(){}}class n{constructor(t,e,i=256){this.p=t;const s=[];for(let o=0;o<i;o+=1)s.push(t.color(t.red(e),t.green(e),t.blue(e),t.alpha(e)*o/(i-1)));this.colorArray=s,this.maxIndex=i-1}stroke(t){this.p.currentRenderer.stroke(this.getColor(t))}fill(t){this.p.currentRenderer.fill(this.getColor(t))}getColor(t){return this.colorArray[t?Math.floor(this.p.map(t,0,255,0,this.maxIndex)):this.maxIndex]}}function a(t,e,a,r){return t&&void 0!==e?null===e?new s(t):a?new n(t,e,r):new i(t,e):new o}class r{constructor(t,e,i,s,o){this.strokeColor=a(t,e,s,o),this.fillColor=a(t,i,s,o)}applyColor(t){this.strokeColor.stroke(t),this.fillColor.fill(t)}}r.UNDEFINED=new r(void 0,void 0,void 0);const h=()=>{},c=(Math.PI,new p5(t=>{t.setup=(()=>{t.noCanvas()})}));function l(t,e){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2)}const d=2*Math.PI;c.createVector(),c.createVector();class p{}class u extends p{get width(){return this.rightPositionX-this.leftPositionX}get height(){return this.bottomPositionY-this.topPositionY}get area(){return this.width*this.height}constructor(t,e,i,s,o=0){super(),this.leftPositionX=t-o,this.topPositionY=e-o,this.rightPositionX=i+o,this.bottomPositionY=s+o}contains(t){return t.x>=this.leftPositionX&&t.x<=this.rightPositionX&&t.y>=this.topPositionY&&t.y<=this.bottomPositionY}}class g{constructor(t=256){this.array=new Array(t),this.length=0}get(t){return this.array[t]}getLast(){return this.array[this.length-1]}push(t){return this.array[this.length]=t,this.length+=1,this.length}pushRawArray(t,e=t.length){for(let i=0;i<e;i+=1)this.array[this.length+i]=t[i];return this.length+=e,this.length}pushAll(t){return this.pushRawArray(t.array,t.length)}pop(){return this.length-=1,this.array[this.length]}clear(){this.length=0}loop(t){!function(t,e,i){let s=0;for(;s<i;)e(t[s],s,t),s+=1}(this.array,t,this.length)}loopBackwards(t){!function(t,e,i){for(;i--;)e(t[i],i,t)}(this.array,t,this.length)}roundRobin(t){!function(t,e,i){for(let s=0,o=i-1;s<o;s+=1)for(let n=s+1;n<i;n+=1)e(t[s],t[n])}(this.array,t,this.length)}nestedLoopJoin(t,e){!function(t,e,i,s,o){for(let n=0;n<s;n+=1)for(let s=0;s<o;s+=1)i(t[n],e[s])}(this.array,t.array,e,this.length,t.length)}}class m{constructor(t,e){this.nodeA=t,this.nodeB=e}isIncidentTo(t){return t===this.nodeA||t===this.nodeB}getAdjacentNode(t){return t===this.nodeB?this.nodeA:this.nodeB}}class y extends g{static drawFunction(t){t.draw()}draw(){this.loop(y.drawFunction)}}class S extends g{static stepFunction(t){t.step()}step(){this.loop(S.stepFunction)}}class w extends g{}w.prototype.step=S.prototype.step,w.prototype.draw=y.prototype.draw;class C extends g{constructor(t){super(t),this.recentRemovedElements=new g(t)}clean(){this.recentRemovedElements.clear();let t=0;for(let e=0;e<this.length;e+=1)this.array[e].clean(),this.array[e].isToBeRemoved?this.recentRemovedElements.push(this.array[e]):(this.array[t]=this.array[e],t+=1);this.length=t}}class v extends C{}v.prototype.draw=w.prototype.draw,v.prototype.step=w.prototype.step;class R{constructor(t,e=1){this.p=t,this.internalValue=e,this.internalReciprocalValue=1/e}get value(){return this.internalValue}set value(t){if(0===t)return this.internalValue=1e-4,void(this.internalReciprocalValue=1e4);this.internalValue=t,this.internalReciprocalValue=1/t}get reciprocalValue(){return this.internalReciprocalValue}applyScale(){this.p.currentRenderer.scale(this.internalValue)}cancel(){this.p.currentRenderer.scale(this.internalReciprocalValue)}}c.createVector(),c.createVector();class A{constructor(){this.position=new p5.Vector,this.velocity=new p5.Vector}step(){this.position.add(this.velocity)}getSpeed(){return this.velocity.mag()}getDirection(){return this.velocity.heading()}addSpeed(t){this.velocity.setMag(Math.max(0,this.velocity.mag()+t))}}const E=c.createVector();class x{constructor(){this.kinematicQuantity=new A,this.position=this.kinematicQuantity.position,this.velocity=this.kinematicQuantity.velocity,this.mass=1,this.collisionRadius=0,this.hasFriction=!1,this.decelerationFactor=1}get x(){return this.position.x}get y(){return this.position.y}get z(){return this.position.z}get vx(){return this.velocity.x}get vy(){return this.velocity.y}get vz(){return this.velocity.z}getSpeed(){return this.kinematicQuantity.getSpeed()}getDirection(){return this.kinematicQuantity.getDirection()}setFriction(t){0!==t?(this.hasFriction=!0,this.decelerationFactor=1-t):this.hasFriction=!1}constrainSpeed(t){this.velocity.magSq()>t*t&&this.velocity.setMag(t)}step(){this.kinematicQuantity.step(),this.hasFriction&&this.kinematicQuantity.velocity.mult(this.decelerationFactor)}accelerate(t,e,i){this.kinematicQuantity.velocity.add(t,e,i)}applyForce(t){this.accelerate(t.x/this.mass,t.y/this.mass,t.z/this.mass)}addSpeed(t){this.kinematicQuantity.addSpeed(t)}collides(t){return l(this.position,t.position)<this.collisionRadius*this.collisionRadius+t.collisionRadius*t.collisionRadius}bounce(t,e=1){this.velocity.add(p5.Vector.mult(t,(1+e)*p5.Vector.dot(this.velocity,p5.Vector.mult(t,-1))))}attractEachOther(t,e,i=0,s,o){const n=this.calculateAttractionForce(t.position,e,i,s,o);n&&(this.applyForce(n),n.mult(-1),t.applyForce(n))}attractToPoint(t,e,i=0,s,o){const n=this.calculateAttractionForce(t,e,i,s,o);n&&this.applyForce(n)}calculateAttractionForce(t,e,i=0,s,o){const n=E;p5.Vector.sub(t,this.position,n);const a=n.magSq();let r=Math.abs(e)/a;return o&&r<o?null:(r=s?Math.min(Math.max(r,i),s):Math.max(r,i),n.setMag(r),e<0&&n.mult(-1),n)}}function f(t,e,i,s,o,n){const a=n||c.createVector(),r=t+(o?-c.HALF_PI:c.HALF_PI);return a.set(Math.cos(r),Math.sin(r)),a.setMag(s*i/e),a}class F{constructor(){this.count=0}resetCount(t=0){return this.count=t,this}step(){this.count+=1}mod(t){return this.count%t}}class M extends F{get isOn(){return this._isOn}constructor(t,e=h){super(),this._isOn=!0,this.completeBehavior=e,this.durationFrameCount=t}on(t){return this._isOn=!0,t&&(this.durationFrameCount=t),this}off(){return this._isOn=!1,this}step(){this._isOn&&(this.count+=1,this.count>this.durationFrameCount&&this.completeCycle())}}class P extends M{get isCompleted(){return this._isCompleted}constructor(t,e){super(t,e),this._isCompleted=!1}on(t){return super.on(t),this}off(){return super.off(),this}resetCount(){return super.resetCount(),this._isCompleted=!1,this}getProgressRatio(){return this._isCompleted?1:this.count/this.durationFrameCount}completeCycle(){this._isCompleted=!0,this._isOn=!1,this.completeBehavior()}}class _ extends x{constructor(t,e,i){super(),this.p=t,this.character=e,this.position.set(t.random(-320,320),t.random(-320,320)),this.setFriction(1);this.graphics=t.createGraphics(40,40);const s=this.graphics;s.strokeWeight(2),s.stroke(32,32,32),s.fill(255),s.rectMode(t.CENTER),s.rect(.5*s.width,.5*s.height,s.width-2,s.height-2,4),s.textAlign(t.CENTER,t.CENTER),s.textFont(i,.7*s.height),s.noStroke(),s.fill(0,0,0),s.text(e,.5*s.width,.38*s.height)}step(){super.step(),this.velocity.magSq()<1e4&&this.position.sub(this.velocity)}draw(){this.p.image(this.graphics,this.position.x,this.position.y)}render(){this.p.noStroke(),this.p.fill(0,0,0),this.p.text(this.character,this.position.x,this.position.y)}drawHud(){this.p.rect(this.position.x,this.position.y,30,30)}toString(){return this.character}}class V extends m{constructor(t,e,i){super(e,i),this.p=t,this.relativePositionA=t.createVector(),this.relativePositionB=t.createVector(),this.update()}step(){this.update()}update(){this.relativePositionA.set(this.nodeA.position.x-this.nodeB.position.x,this.nodeA.position.y-this.nodeB.position.y),this.relativePositionB.set(this.nodeB.position.x-this.nodeA.position.x,this.nodeB.position.y-this.nodeA.position.y),this.directionAngleA=this.relativePositionA.heading(),this.directionAngleB=this.directionAngleA+this.p.PI,this.directionAngleB>this.p.TWO_PI&&(this.directionAngleB-=this.p.TWO_PI),this.distanceSquared=l(this.nodeA.position,this.nodeB.position)}getRelativePosition(t){return t===this.nodeB?this.relativePositionA:this.relativePositionB}getDirectionAngle(t){return t===this.nodeB?this.directionAngleA:this.directionAngleB}}class b extends V{constructor(t,e,i,s=100,o=.005){super(t,e,i),b.isInitialized||(b.temporalVector=t.createVector(),b.isInitialized=!0),this.equilibriumLength=s,this.springConstant=o}step(){super.step();const t=this.nodeA,e=this.nodeB,i=this.p.sqrt(this.distanceSquared)-this.equilibriumLength,s=b.temporalVector;s.set(this.relativePositionB),s.setMag(this.springConstant*i),t.applyForce(s),s.mult(-1),e.applyForce(s)}}b.isInitialized=!1;class B extends b{constructor(t,e,i){super(t,e,i,20,.001)}step(){super.step()}draw(){this.p.line(this.nodeA.position.x,this.nodeA.position.y,this.nodeB.position.x,this.nodeB.position.y)}drawHud(){this.draw()}toString(){return this.nodeA+" -> "+this.nodeB}}class k{constructor(t,e,i,s){this.p=t,this.font=i,this.camera=s,this.nodes=new w,this.edges=new w,this.nodeMap=new Map,this.incomingEdgesMap=new Map,this.outgoingEdgesMap=new Map,this.applyRepulsion=((t,e)=>{if(l(t.position,e.position)>16e4)return;const i=this.getIncomingEdges(t).length+this.getOutgoingEdges(t).length+(this.getIncomingEdges(e).length+this.getOutgoingEdges(e).length);t.attractEachOther(e,-2e7*this.p.unitAccelerationMagnitude*this.repulsionRatio*i,0,5e4*this.p.unitAccelerationMagnitude*this.repulsionRatio,500*this.p.unitAccelerationMagnitude)}),this.updateMass=(t=>{t.mass*=1.001}),this.keepAwayEdgePair=((t,e,i,s)=>{const o=e.getDirectionAngle(t),n=i.getDirectionAngle(t),a=function(t,e){let i=(t-e)%d;return i<-Math.PI?i+=d:i>Math.PI&&(i-=d),i}(n,o),r=this.p.abs(a)/this.p.PI,h=s/this.p.sq(Math.max(r,.05)),c=k.temporalVector,l=a>0,p=e.distanceSquared;if(p>1){const i=f(o,this.p.sqrt(p),1,h,l,c);e.getAdjacentNode(t).applyForce(i)}const u=i.distanceSquared;if(u>1){const e=f(n,this.p.sqrt(u),1,h,!l,c);i.getAdjacentNode(t).applyForce(e)}}),this.drawNode=(t=>{this.camera.region.contains(t.position)&&t.draw()}),this.drawEdge=(t=>{(this.camera.region.contains(t.nodeA.position)||this.camera.region.contains(t.nodeB.position))&&t.draw()}),this.keepAwayIncidentEdges=(t=>{const e=k.temporalEdgeArray;e.clear(),e.pushAll(this.getIncomingEdges(t)),e.pushAll(this.getOutgoingEdges(t));const i=e.length;for(let s=0;s<i;s+=1){const o=(s+1)%i;this.keepAwayEdgePair(t,e.get(s),e.get(o),.3)}}),k.temporalVector=t.createVector();for(const o of e){const e=t.split(o,"\t"),i=e.length-1,s=e[i];for(let t=0;t<i;t+=1)this.addEdge(e[t],s)}this.edges.loop(e=>{const i=this.getIncomingEdges(e.nodeA).length+this.getOutgoingEdges(e.nodeA).length,s=this.getIncomingEdges(e.nodeB).length+this.getOutgoingEdges(e.nodeB).length,o=t.abs(i-s);e.springConstant=.005*(1+o)}),this.repulsionTimer=new P(420),this.averagePosition=t.createVector(),this.edgeColor=new r(t,t.color(64),void 0),this.hudBackgroundColor=new r(t,null,t.color(0,192)),this.hudNodeColor=new r(t,null,t.color(255,64)),this.hudEdgeColor=new r(t,t.color(255,32),void 0),this.hudCameraColor=new r(t,t.color(255,0,0,192),null)}toString(){let t="";for(let e=0,i=this.edges.length;e<i;e+=1)t+=this.edges.array[e]+"\n";return t}step(){this.repulsionTimer.step(),this.repulsionRatio=this.p.sq(this.repulsionTimer.getProgressRatio()),this.nodes.loop(this.updateMass),this.edges.step(),this.nodes.step(),this.nodes.roundRobin(this.applyRepulsion)}draw(){this.p.strokeWeight(1),this.edgeColor.applyColor(),this.edges.loop(this.drawEdge),this.nodes.loop(this.drawNode)}drawHud(){this.hudBackgroundColor.applyColor(),this.p.rect(0,0,this.p.nonScaledWidth,this.p.nonScaledHeight),this.p.scale(.28),this.p.blendMode(this.p.ADD),this.p.strokeWeight(16),this.hudEdgeColor.applyColor(),this.edges.loop(this.drawHudEdge),this.hudNodeColor.applyColor(),this.nodes.loop(this.drawHudNode),this.p.strokeWeight(10),this.hudCameraColor.applyColor(),this.p.rect(this.camera.scaleFactor.reciprocalValue*this.camera.position.x,this.camera.scaleFactor.reciprocalValue*this.camera.position.y,this.camera.scaleFactor.reciprocalValue*this.p.nonScaledWidth,this.camera.scaleFactor.reciprocalValue*this.p.nonScaledHeight),this.p.blendMode(this.p.BLEND),this.p.scale(1/.28)}addEdge(t,e){const i=this.getOrCreateNode(t),s=this.getOrCreateNode(e);for(let n=0;n<this.edges.length;n+=1){const t=this.edges.get(n);if(i===t.nodeA&&s===t.nodeB)return}const o=new B(this.p,i,s);this.edges.push(o),this.getOutgoingEdges(i).push(o),i.mass+=2,this.getIncomingEdges(s).push(o)}getIncomingEdges(t){const e=this.incomingEdgesMap.get(t);if(!e)throw"Passed unregistered node to getIncomingEdges().";return e}getOutgoingEdges(t){const e=this.outgoingEdgesMap.get(t);if(!e)throw"Passed unregistered node to getOutgoingEdges().";return e}getAveragePosition(){return this.averagePosition.set(0,0),this.nodes.loop(t=>{this.averagePosition.add(t.position)}),this.averagePosition.div(Math.max(1,this.nodes.length)),this.averagePosition}getOrCreateNode(t){const e=this.nodeMap.get(t);if(e)return e;const i=new _(this.p,t,this.font);return this.nodeMap.set(t,i),this.nodes.push(i),this.incomingEdgesMap.set(i,new w),this.outgoingEdgesMap.set(i,new w),i}drawHudNode(t){t.drawHud()}drawHudEdge(t){t.drawHud()}}k.temporalEdgeArray=new g;p5.disableFriendlyErrors=!0;new p5;new class extends p5{setCurrentRenderer(t){this.currentRenderer=t}get nonScaledWidth(){return this.scalableCanvas.nonScaledWidth}get nonScaledHeight(){return this.scalableCanvas.nonScaledHeight}get idealFrameRate(){return this._idealFrameRate}get unitAngleSpeed(){return this._unitAngleSpeed}get unitSpeed(){return this._unitSpeed}get unitAccelerationMagnitude(){return this._unitAccelerationMagnitude}constructor(t,e,i){super(t,"string"==typeof e?document.getElementById(e)||void 0:e,i),this.node=e&&"boolean"!=typeof e?"string"==typeof e?document.getElementById(e)||document.body:e:document.body,this.currentRenderer=this,this.maxCanvasRegion={width:0,height:0,getShortSideLength(){return Math.min(this.width,this.height)}},this.updateMaxCanvasRegion(),this.setFrameRate()}setFrameRate(t=60){return this.frameRate(t),t&&(this._idealFrameRate=t,this._unitAngleSpeed=2*Math.PI/this._idealFrameRate,this._unitSpeed=1/this._idealFrameRate,this._unitAccelerationMagnitude=this._unitSpeed/this._idealFrameRate),this}updateMaxCanvasRegion(){if(this.maxCanvasRegion.width=this.windowWidth,this.maxCanvasRegion.height=this.windowHeight,this.node===document.body)return;const t=this.node.getBoundingClientRect();this.maxCanvasRegion.width=t.width,this.maxCanvasRegion.height=t.height}createScalableCanvas(e,i,s){this.scalableCanvasType=e,this.scalableCanvas=new t(this,this.createScalableCanvasParameter(e,i),this.node,s)}resizeScalableCanvas(t,e){this.scalableCanvas.resize(this.createScalableCanvasParameter(t||this.scalableCanvasType,e))}createScalableCanvasParameter(i,s){this.updateMaxCanvasRegion();const o=this.maxCanvasRegion.getShortSideLength();switch(i){case e.SQUARE640x640:return{scaledWidth:o,scaledHeight:o,nonScaledShortSideLength:640};case e.RECT640x480:return{scaledWidth:o,scaledHeight:.75*o,nonScaledShortSideLength:480};case e.FULL:return{scaledWidth:this.maxCanvasRegion.width,scaledHeight:this.maxCanvasRegion.height,nonScaledShortSideLength:640};default:return s||t.DUMMY_PARAMETERS}}}(t=>{const i=t.color(248);let s,o,n,a;t.preload=(()=>{s=t.loadFont("./assets/mplus-1p-light.ttf"),o=t.loadStrings("./assets/kanji-data.txt")}),t.setup=(()=>{window.noCanvas(),t.createScalableCanvas(e.SQUARE640x640),n=new class{constructor(t,e=.8){this.p=t,this.position=t.createVector(),this.scaleFactor=new R(t,e),this.updateRegion()}apply(){this.p.translate(-this.position.x,-this.position.y),this.scaleFactor.applyScale()}cancel(){this.scaleFactor.cancel(),this.p.translate(this.position.x,this.position.y)}updatePosition(){const t=2*this.scaleFactor.reciprocalValue*this.p.scalableCanvas.getNonScaledValueOf(this.p.mouseX-this.p.pmouseX),e=2*this.scaleFactor.reciprocalValue*this.p.scalableCanvas.getNonScaledValueOf(this.p.mouseY-this.p.pmouseY);this.position.sub(t,e),this.updateRegion()}updateRegion(){const t=this.scaleFactor.reciprocalValue,e=.5*t*this.p.nonScaledWidth,i=.5*t*this.p.nonScaledHeight,s=t*this.position.x,o=t*this.position.y;this.region=new u(s-e,o-i,s+e,o+i,32*t)}}(t,.8),a=new k(t,o,s,n),t.rectMode(t.CENTER),t.textFont(s,20),t.textAlign(t.CENTER,t.CENTER),t.fill(0,0,0),t.imageMode(t.CENTER),t.frameRate(30)}),t.draw=(()=>{a.step(),t.background(i),t.scalableCanvas.scale(),t.translate(.5*t.nonScaledWidth,.5*t.nonScaledHeight),n.apply(),a.draw(),n.cancel(),t.translate((5/6-.5)*t.nonScaledWidth,(5/6-.5)*t.nonScaledHeight),t.scale(1/3),a.drawHud()}),t.windowResized=(()=>{t.resizeScalableCanvas(),t.background(255)}),t.mouseDragged=(()=>{n.updatePosition()}),t.mousePressed=(()=>{}),t.touchMoved=(()=>{if(!(t.mouseX<0||t.mouseY>t.width||t.mouseY<0||t.mouseY>t.height))return!1})},"KanjiNetwork")}();