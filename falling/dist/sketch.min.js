/**
 * Falling.
 * Source code in TypeScript: https://github.com/fal-works/p5js-sketches/tree/master/falling

 * @copyright 2019 FAL
 * @version 0.1.0
 */
!function(e,t){"use strict";const{ArrayList:a,Vector2D:n,SimpleDynamics:r,Random:c,Timer:o,Tween:s,Easing:i,Numeric:{cube:u}}=t,{Noise:l,ShapeColor:h}=e;let d,p;e.onSetup.push(e=>{d=e}),e.onSetup.push(()=>{p=e.canvas});const g=t.HtmlUtility.getElementOrBody("Falling"),m={width:g.getBoundingClientRect().width,height:g.getBoundingClientRect().height},y=(()=>{const e=m.height+20,t=h.create(void 0,[32,192],255),a=o.Set.construct(1024),n={start:10,end:20,easing:i.Out.createBack()};return{timerSet:a,create:(e,t)=>{const c=Object.assign(Object.assign({},r.createQuantity(e,t)),{alpha:255,size:0});return a.add(s.create(e=>{c.size=e},30,n)),c},update:t=>(t.fy=.05,r.updateEuler(t),t.alpha-=2,t.alpha<=0||t.y>=e),draw:e=>{h.apply(t,e.alpha),d.circle(e.x,e.y,e.size)}}})(),f=(()=>{const e=a.create(1024);return{update:()=>{y.timerSet.step(),a.removeShiftAll(e,y.update)},draw:()=>a.loop(e,y.draw),add:(t,n)=>a.add(e,y.create(t,n))}})(),w=(()=>{const e=Math.floor(m.width/25),t=Math.floor(m.height/25),a=(e,t)=>({column:e,row:t,nextMoves:[]}),r=a(-1,0),o=a(0,-1),s=a(1,0),i=a(0,1);r.nextMoves.push(r,o,i),o.nextMoves.push(r,o,s),s.nextMoves.push(o,s,i),i.nextMoves.push(r,s,i);const u=[r,o,s,i];let l=Math.floor(e/2),h=Math.floor(t/2),d=a(0,0);d.nextMoves.push(...u);const p=e=>{switch(e){default:case r:return s;case o:return i;case s:return r;case i:return o}},g=()=>c.Arrays.get(d.nextMoves),y=a=>{const n=l+a.column;if(n<0||n>=e)return d=p(d),!1;const r=h+a.row;return r<0||r>=t?(d=p(d),!1):(l=n,h=r,!0)};return{nextPosition:()=>{let e=g();for(;!y(e);)e=g();return d=e,t=l,a=h,n.create(25*(.5+t),25*(.5+a));var t,a}}})(),v={create:(e,t=1)=>({callback:e,frequency:t,accumulation:0}),run:e=>{for(e.accumulation+=e.frequency;e.accumulation>=1;)e.accumulation-=1,e.callback()}};let x;const M=v.create(()=>{const e=w.nextPosition();f.add(e.x,e.y)}),S=l.withChangeRate(.05),k=()=>{f.draw()},C=()=>{M.frequency=18*u(S()),v.run(M),f.update(),x(),p.drawScaled(k)},b=()=>{switch(d.key){case"p":e.pauseOrResume();break;case"g":d.save("image.png")}};e.startSketch({htmlElement:g,logicalCanvasSize:m,initialize:()=>{d.background(252),x=e.storePixels(),d.noStroke()},setP5Methods:e=>{e.draw=C,e.keyTyped=b},fittingOption:null})}(p5ex,CreativeCodingCore);