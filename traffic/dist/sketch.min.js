/**
 * Traffic.
 * Including module: p5ex (Copyright 2018 FAL, licensed under MIT).
 * Website => https://www.fal-works.com/
 * @copyright 2019 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.1
 * @license CC-BY-SA-3.0
 */
!function(){"use strict";class t{}class e extends t{get width(){return this.rightPositionX-this.leftPositionX}get height(){return this.bottomPositionY-this.topPositionY}get area(){return this.width*this.height}constructor(t,e,i,o,n=0){super(),this.leftPositionX=t-n,this.topPositionY=e-n,this.rightPositionX=i+n,this.bottomPositionY=o+n}contains(t,e=0){return t.x>=this.leftPositionX-e&&t.x<=this.rightPositionX+e&&t.y>=this.topPositionY-e&&t.y<=this.bottomPositionY+e}constrain(t,e=0){t.x<this.leftPositionX-e?t.x=this.leftPositionX-e:t.x>this.rightPositionX+e&&(t.x=this.rightPositionX+e),t.y<this.topPositionY-e?t.y=this.topPositionY-e:t.y>this.bottomPositionY+e&&(t.y=this.bottomPositionY+e)}}class i{constructor(t,i,o,n){this.p=t,this.canvasElement=t.createCanvas(i.scaledWidth,i.scaledHeight,n),this.canvasElement&&"parent"in this.canvasElement&&this.canvasElement.parent(o),this.region=new e(0,0,0,0),this.nonScaledShortSideLength=i.nonScaledShortSideLength,this.updateSize()}get scaleFactor(){return this._scaleFactor}get nonScaledWidth(){return this._nonScaledWidth}get nonScaledHeight(){return this._nonScaledHeight}get aspectRatio(){return this._aspectRatio}resize(t){this.p.resizeCanvas(t.scaledWidth,t.scaledHeight),this.nonScaledShortSideLength=t.nonScaledShortSideLength,this.updateSize()}updateSize(){const t=this.p;this._scaleFactor=Math.min(t.width,t.height)/this.nonScaledShortSideLength,this._inversedScaleFactor=1/this._scaleFactor,this._nonScaledWidth=t.width/this._scaleFactor,this._nonScaledHeight=t.height/this._scaleFactor,this._aspectRatio=t.width/t.height,this.region.rightPositionX=this._nonScaledWidth,this.region.bottomPositionY=this._nonScaledHeight}scale(){this.p.scale(this._scaleFactor)}cancelScale(){this.p.scale(this._inversedScaleFactor)}getNonScaledValueOf(t){return t/this._scaleFactor}}i.DUMMY_PARAMETERS={scaledWidth:100,scaledHeight:100,nonScaledShortSideLength:100};const o={SQUARE640x640:"SQUARE640x640",RECT640x480:"RECT640x480",FULL:"FULL",CUSTOM:"CUSTOM"};class n{constructor(t,e){this.p=t,this.p5Color=e}stroke(){this.p.currentRenderer.stroke(this.p5Color)}fill(){this.p.currentRenderer.fill(this.p5Color)}}class s{constructor(t){this.p=t}stroke(){this.p.currentRenderer.noStroke()}fill(){this.p.currentRenderer.noFill()}}class a{stroke(){}fill(){}}class r{constructor(t,e,i=256){this.p=t;const o=[];for(let n=0;n<i;n+=1)o.push(t.color(t.red(e),t.green(e),t.blue(e),t.alpha(e)*n/(i-1)));this.colorArray=o,this.maxIndex=i-1}stroke(t){this.p.currentRenderer.stroke(this.getColor(t))}fill(t){this.p.currentRenderer.fill(this.getColor(t))}getColor(t){return this.colorArray[t?Math.floor(this.p.map(t,0,255,0,this.maxIndex)):this.maxIndex]}}function h(t,e,i,o){return t&&void 0!==e?null===e?new s(t):i?new r(t,e,o):new n(t,e):new a}class c{constructor(t,e,i,o,n){this.strokeColor=h(t,e,o,n),this.fillColor=h(t,i,o,n)}applyColor(t){this.strokeColor.stroke(t),this.fillColor.fill(t)}}c.UNDEFINED=new c(void 0,void 0,void 0);const l=()=>{},d=(Math.PI,new p5(t=>{t.setup=(()=>{t.noCanvas()})}));Math.PI,d.createVector(),d.createVector();class u{constructor(t=256){this.array=new Array(t),this.length=0}get(t){return this.array[t]}getLast(){return this.array[this.length-1]}push(t){return this.array[this.length]=t,this.length+=1,this.length}pushRawArray(t,e=t.length){for(let i=0;i<e;i+=1)this.array[this.length+i]=t[i];return this.length+=e,this.length}pushAll(t){return this.pushRawArray(t.array,t.length)}pop(){return this.length-=1,this.array[this.length]}clear(){this.length=0}loop(t){!function(t,e,i){let o=0;for(;o<i;)e(t[o],o,t),o+=1}(this.array,t,this.length)}loopBackwards(t){!function(t,e,i){for(;i--;)e(t[i],i,t)}(this.array,t,this.length)}roundRobin(t){!function(t,e,i){for(let o=0,n=i-1;o<n;o+=1)for(let n=o+1;n<i;n+=1)e(t[o],t[n])}(this.array,t,this.length)}nestedLoopJoin(t,e){!function(t,e,i,o,n){for(let s=0;s<o;s+=1)for(let o=0;o<n;o+=1)i(t[s],e[o])}(this.array,t.array,e,this.length,t.length)}}class p extends u{static drawFunction(t){t.draw()}draw(){this.loop(p.drawFunction)}}class g extends u{static stepFunction(t){t.step()}step(){this.loop(g.stepFunction)}}class y extends u{}y.prototype.step=g.prototype.step,y.prototype.draw=p.prototype.draw;class f extends u{constructor(t){super(t),this.recentRemovedElements=new u(t)}clean(){this.recentRemovedElements.clear();let t=0;for(let e=0;e<this.length;e+=1)this.array[e].clean(),this.array[e].isToBeRemoved?this.recentRemovedElements.push(this.array[e]):(this.array[t]=this.array[e],t+=1);this.length=t}}class m extends f{}m.prototype.draw=y.prototype.draw,m.prototype.step=y.prototype.step;d.createVector(),d.createVector(),d.createVector();class R{constructor(){this.count=0}resetCount(t=0){return this.count=t,this}step(){this.count+=1}mod(t){return this.count%t}}class C extends R{get isOn(){return this._isOn}constructor(t,e=l){super(),this._isOn=!0,this.completeBehavior=e,this.durationFrameCount=t}on(t){return this._isOn=!0,t&&(this.durationFrameCount=t),this}off(){return this._isOn=!1,this}step(){this._isOn&&(this.count+=1,this.count>this.durationFrameCount&&this.completeCycle())}}class S extends C{get isCompleted(){return this._isCompleted}constructor(t,e){super(t,e),this._isCompleted=!1}on(t){return super.on(t),this}off(){return super.off(),this}resetCount(){return super.resetCount(),this._isCompleted=!1,this}getProgressRatio(){return this._isCompleted?1:this.count/this.durationFrameCount}completeCycle(){this._isCompleted=!0,this._isOn=!1,this.completeBehavior()}}var x,v;(v=x||(x={}))[v.TOP=0]="TOP",v[v.BOTTOM=1]="BOTTOM",v[v.LEFT=2]="LEFT",v[v.RIGHT=3]="RIGHT";new class extends p5{setCurrentRenderer(t){this.currentRenderer=t}get nonScaledWidth(){return this.scalableCanvas.nonScaledWidth}get nonScaledHeight(){return this.scalableCanvas.nonScaledHeight}get idealFrameRate(){return this._idealFrameRate}get unitAngleSpeed(){return this._unitAngleSpeed}get unitSpeed(){return this._unitSpeed}get unitAccelerationMagnitude(){return this._unitAccelerationMagnitude}constructor(t,e,i){super(t,"string"==typeof e?document.getElementById(e)||void 0:e,i),this.node=e&&"boolean"!=typeof e?"string"==typeof e?document.getElementById(e)||document.body:e:document.body,this.currentRenderer=this,this.maxCanvasRegion={width:0,height:0,getShortSideLength(){return Math.min(this.width,this.height)}},this.updateMaxCanvasRegion(),this.setFrameRate()}setFrameRate(t=60){return this.frameRate(t),t&&(this._idealFrameRate=t,this._unitAngleSpeed=2*Math.PI/this._idealFrameRate,this._unitSpeed=1/this._idealFrameRate,this._unitAccelerationMagnitude=this._unitSpeed/this._idealFrameRate),this}updateMaxCanvasRegion(){if(this.maxCanvasRegion.width=this.windowWidth,this.maxCanvasRegion.height=this.windowHeight,this.node===document.body)return;const t=this.node.getBoundingClientRect();this.maxCanvasRegion.width=t.width,this.maxCanvasRegion.height=t.height}createScalableCanvas(t,e,o){this.scalableCanvasType=t,this.scalableCanvas=new i(this,this.createScalableCanvasParameter(t,e),this.node,o)}resizeScalableCanvas(t,e){this.scalableCanvas.resize(this.createScalableCanvasParameter(t||this.scalableCanvasType,e))}createScalableCanvasParameter(t,e){this.updateMaxCanvasRegion();const n=this.maxCanvasRegion.getShortSideLength();switch(t){case o.SQUARE640x640:return{scaledWidth:n,scaledHeight:n,nonScaledShortSideLength:640};case o.RECT640x480:return{scaledWidth:n,scaledHeight:.75*n,nonScaledShortSideLength:480};case o.FULL:return{scaledWidth:this.maxCanvasRegion.width,scaledHeight:this.maxCanvasRegion.height,nonScaledShortSideLength:640};default:return e||i.DUMMY_PARAMETERS}}}(t=>{const e=[0,1,2,3],i=24,n=64,s=12,a=.2,r=60,h=i*i,l=.0025,d=30,p={start:-.5,end:.5},g={start:-.05,end:.05},y={start:.002,end:.005},f={start:-1e-4,end:1e-4},m=.01,R=.02,C=.75;let x,v,w,P,_,F,b,L;function T(e){return t.random(e.start,e.end)}function M(e,i){return t.constrain(e,i.start,i.end)}function A(e,i,o,n){t.ellipse(t.lerp(e.x,i.x,o),t.lerp(e.y,i.y,o),n,n)}function E(e){let i,o;const n=t.random(.2,.8);switch(e){default:case 0:i=n*t.width,o=0;break;case 1:i=n*t.width,o=t.height;break;case 2:i=0,o=n*t.height;break;case 3:i=t.width,o=n*t.height}return{position:t.createVector(i,o),velocity:0,acceleration:0,bound:e}}function k(){const i=t.random(e),o=t.random(e.filter(t=>t!=i));return{startPoint:E(i),endPoint:E(o),intersectionList:[]}}function O(e){Math.random()<m&&(e.acceleration=T(g)),e.velocity=M(e.velocity+e.acceleration,p);const i=e.position;switch(e.bound){case 0:case 1:i.x+=e.velocity,i.x<0?(i.x=1,e.velocity=0,e.acceleration=2*g.end):i.x>t.width&&(i.x=t.width-1,e.velocity=0,e.acceleration=2*g.start);break;case 2:case 3:i.y+=e.velocity,i.y<0?(i.y=1,e.velocity=0,e.acceleration=2*g.end):i.y>t.height&&(i.y=t.height-1,e.velocity=0,e.acceleration=2*g.start)}}function W(t){O(t.startPoint),O(t.endPoint)}function B(e){const i=e.startPoint.position,o=e.endPoint.position;t.line(i.x,i.y,o.x,o.y)}function H(t){t.intersectionList.length=0}function Y(t,e){const i=t.startPoint.position,o=t.endPoint.position,n=e.startPoint.position,s=e.endPoint.position;let a=(o.x-i.x)*(s.y-n.y)-(o.y-i.y)*(s.x-n.x);if(0==a)return;const r=n.x-i.x,h=n.y-i.y,c=((s.y-n.y)*r-(s.x-n.x)*h)/a;if(c<0||c>1)return;const l=((o.y-i.y)*r-(o.x-i.x)*h)/a;if(l<0||l>1)return;const d=function(t){const e=t.size-1;return t.size=e,t.array[e]}(x);v.push(d),d.roadA=t,d.positionRatioA=c,d.roadB=e,d.positionRatioB=l,t.intersectionList.push(d),e.intersectionList.push(d)}function U(t){var e,i;i=t,(e=x).array[e.size++]=i}function z(t,e){const i=t.road;let o,n,s;e.roadA===i?(o=e.roadB,n=e.positionRatioA,s=e.positionRatioB):(o=e.roadA,n=e.positionRatioB,s=e.positionRatioA);const a=t.positionRatio-n;return!(a<-l||a>l||(Math.random()>=C?(t.positionRatio=n+l,1):(t.road=o,t.positionRatio=s+l,t.roadChangeEffectTimer.resetCount().on(),0)))}function I(t){Math.random()<R&&(t.acceleration=T(f));let e=M(t.positionRatioChangeRate+t.acceleration,y);t.positionRatioChangeRate=e,t.positionRatioTotalChange+=e;let i=t.positionRatio;(i+=e)>1&&(i-=1),t.positionRatio=i;for(const e of t.road.intersectionList)if(z(t,e))return;t.roadChangeEffectTimer.step()}function X(t){const e=t.road,i=e.startPoint.position,o=e.endPoint.position,n=t.positionRatio,h=(1+a*Math.cos(r*t.positionRatioTotalChange))*s,c=t.roadChangeEffectTimer,l=c.getProgressRatio();c.isOn&&l<1?(b.applyColor(255*l),A(i,o,n,h),L.applyColor(255*(1-l)),A(i,o,n,h)):(b.applyColor(),A(i,o,n,h))}function V(){P=new u(i);for(let t=0;t<i;t++)P.push(k());_=new u(n);const e=P.array;for(let i=0;i<n;i++)_.push({road:t.random(e),positionRatio:Math.random(),positionRatioChangeRate:T(y),positionRatioTotalChange:0,acceleration:0,roadChangeEffectTimer:new S(d).off()});const o=k();x=function(t,e){const i=[];for(let o=0;o<e;o++)i.push(t());return{array:i,size:i.length}}(()=>({roadA:o,positionRatioA:0,roadB:o,positionRatioB:0}),h),v=new u(h)}t.preload=(()=>{}),t.setup=(()=>{t.createScalableCanvas(o.FULL);const e=function(t,e,i,o,n,s,a=1,r=1){const h=t.createGraphics(e,i);h.background(o),h.strokeWeight(2*r);for(let o=0;o<i;o+=r){const r=Math.pow(o/(i-1),a);h.stroke(t.lerpColor(n,s,r)),h.line(0,o,e-1,o)}return h}(t,t.nonScaledWidth,t.nonScaledHeight,t.color(254,254,255),t.color(254,254,255),t.color(244,244,255),4,2);t.scalableCanvas.scale(),t.image(e,0,0),t.scalableCanvas.cancelScale(),t.loadPixels(),w=t.pixels,t.noFill(),F=new c(t,t.color(128),void 0,!1),b=new c(t,t.color(0,112,255),void 0,!0),L=new c(t,t.color(240,0,128),void 0,!0),V()}),t.draw=(()=>{t.pixels=w,t.updatePixels(),P.loop(W),P.loop(H),v.loop(U),v.clear(),P.roundRobin(Y),_.loop(I),F.applyColor(),t.strokeWeight(1),P.loop(B),t.strokeWeight(2),_.loop(X)}),t.mousePressed=(()=>{V()}),t.keyTyped=(()=>{"p"===t.key&&t.noLoop()})},"Traffic")}();