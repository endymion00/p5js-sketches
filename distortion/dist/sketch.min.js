/**
 * Distortion.
 * Source code in TypeScript: https://github.com/fal-works/p5js-sketches/tree/master/distortion

 * @copyright 2020 FAL
 * @version 0.1.0
 */
!function(e,t){"use strict";const{Numeric:a,Arrays:s}=t,{onSetup:i,onInstantiate:o}=e;let n,r;o.push(e=>{n=e}),i.push(()=>{r=e.canvas});let l,c,d,p=0;const u=()=>{r.drawScaled(()=>{n.image(l,0,0)}),n.loadPixels(),c=n.pixels.slice(),d=s.createIntegerSequence(a.ceil(n.width))},g=(e,t,a)=>-.5+n.noise(e+t+.005*a),h={draw:()=>{const{floor:e}=a,{pixels:t,width:s,frameCount:i}=n,o=t.length,r=4*s,l=o-r,u=.3*a.cube(n.noise(.03*i));p+=u;let h=0,f=0;for(;h<r;)t[h]=c[h++],t[h]=c[h++],t[h]=c[h],h+=2;f+=1;let m=-1,w=[];for(;h<l;){const i=f>>2;if(m!=i){m=i;const t=a.pow4(n.noise(.05*m+p));w=d.map(a=>e(.65*t*g(m,p,a)*s)<<2)}for(let e=0;e<s;e+=1){const a=h+w[e];t[h]=c[a],t[h+1]=c[a+1],t[h+2]=c[a+2],h+=4}f+=1}for(;h<o;)t[h]=c[h++],t[h]=c[h++],t[h]=c[h],h+=2;n.updatePixels()},keyTyped:()=>{switch(n.key){case"p":e.pauseOrResume();break;case"g":n.save("image.png");break;case"r":u()}return!1},preload:()=>{l=n.loadImage("photo.jpg")}};e.startSketch({htmlElement:"Distortion",logicalCanvasHeight:1080,logicalCanvasWidth:1920,initialize:()=>{n.pixelDensity(1),n.frameRate(30),u()},windowResized:()=>r.resizeIfNeeded(),onCanvasResized:u,p5Methods:h})}(p5ex,CreativeCodingCore);