{"version":3,"file":"sketch.js","sources":["../src/common.ts","../src/settings.ts","../src/sketch.ts","../src/main.ts"],"sourcesContent":["/**\n * ---- Common ----------------------------------------------------------------\n */\n\nimport p5 from \"p5\";\nimport * as CCC from \"@fal-works/creative-coding-core\";\nimport * as p5ex from \"@fal-works/p5-extension\";\n\nexport const { Numeric, Arrays } = CCC;\n\nexport const { onSetup, onInstantiate } = p5ex;\n\n/**\n * Shared p5 instance.\n */\nexport let p: p5;\n\nonInstantiate.push((p5Instance) => {\n  p = p5Instance;\n});\n\n/**\n * Shared canvas instance.\n */\nexport let canvas: p5ex.ScaledCanvas;\n\nonSetup.push(() => {\n  canvas = p5ex.canvas;\n});\n\nexport const resetCommon = () => {};\n","/**\n * ---- Settings --------------------------------------------------------------\n */\n\n/** The id of the HTML element to which the canvas should belong. */\nexport const HTML_ELEMENT_ID = \"Distortion\";\n\n/** The logical width of the canvas. */\nexport const LOGICAL_CANVAS_WIDTH = 1920;\n\n/** The logical height of the canvas. */\nexport const LOGICAL_CANVAS_HEIGHT = 1080;\n","/**\n * ---- Sketch ----------------------------------------------------------------\n */\n\nimport { pauseOrResume } from \"@fal-works/p5-extension\";\nimport { p, canvas, resetCommon, Numeric, Arrays } from \"./common\";\n\nimport p5 from \"p5\";\n\n// ---- variables | functions ----\nlet photo: p5.Image;\nlet originalPixels: number[];\nlet x: number[];\nlet time = 0;\n\n// ---- reset & initialize ----\nconst preload = () => {\n  photo = p.loadImage(\"photo.jpg\"); // eslint-disable-line\n};\n\nexport const reset = () => {\n  canvas.drawScaled(() => {\n    p.image(photo, 0, 0);\n  });\n\n  p.loadPixels();\n  originalPixels = p.pixels.slice();\n  x = Arrays.createIntegerSequence(Numeric.ceil(p.width));\n\n  resetCommon();\n};\n\nexport const initialize = (): void => {\n  p.pixelDensity(1);\n  p.frameRate(30);\n  reset();\n};\n\n// ---- draw ----\nconst noise = (rowOffset: number, time: number, x: number) =>\n  -0.5 + p.noise(rowOffset + time + x * 0.005);\n\nconst draw = (): void => {\n  const { floor } = Numeric;\n  const { pixels, width, frameCount } = p;\n  const totalLength = pixels.length;\n  const indicesPerRow = width * 4;\n  const editLength = totalLength - indicesPerRow;\n\n  const timeScale = 0.3 * Numeric.cube(p.noise(frameCount * 0.03));\n  time += timeScale;\n\n  let index = 0;\n  let y = 0;\n\n  // first row\n  while (index < indicesPerRow) {\n    pixels[index] = originalPixels[index++];\n    pixels[index] = originalPixels[index++];\n    pixels[index] = originalPixels[index];\n    index += 2;\n  }\n  y += 1;\n\n  // middle rows\n  let row = -1;\n  let indexOffset: number[] = [];\n  while (index < editLength) {\n    const newRow = y >> 2;\n    if (row != newRow) {\n      row = newRow;\n      const noiseFactor = Numeric.pow4(p.noise(0.05 * row + time));\n      indexOffset = x.map(\n        (x) => floor(noiseFactor * 0.65 * noise(row, time, x) * width) << 2\n      );\n    }\n\n    for (let x = 0; x < width; x += 1) {\n      const sourceIndex = index + indexOffset[x];\n      pixels[index] = originalPixels[sourceIndex];\n      pixels[index + 1] = originalPixels[sourceIndex + 1];\n      pixels[index + 2] = originalPixels[sourceIndex + 2];\n      index += 4;\n    }\n    y += 1;\n  }\n\n  // last row\n  while (index < totalLength) {\n    pixels[index] = originalPixels[index++];\n    pixels[index] = originalPixels[index++];\n    pixels[index] = originalPixels[index];\n    index += 2;\n  }\n\n  p.updatePixels();\n};\n\n// ---- UI ----\n\nconst keyTyped = () => {\n  switch (p.key) {\n    case \"p\":\n      pauseOrResume();\n      break;\n    case \"g\":\n      p.save(\"image.png\");\n      break;\n    case \"r\":\n      reset();\n      break;\n  }\n\n  return false;\n};\n\n// ---- p5 methods ----\n\nexport const p5Methods = {\n  draw,\n  keyTyped,\n  preload,\n};\n","/**\n * ---- Main ------------------------------------------------------------------\n */\n\nimport { startSketch } from \"@fal-works/p5-extension\";\n\nimport { canvas } from \"./common\";\nimport {\n  HTML_ELEMENT_ID,\n  LOGICAL_CANVAS_WIDTH,\n  LOGICAL_CANVAS_HEIGHT,\n} from \"./settings\";\nimport * as sketch from \"./sketch\";\n\n// ---- start sketch ----\n\nstartSketch({\n  htmlElement: HTML_ELEMENT_ID,\n  logicalCanvasHeight: LOGICAL_CANVAS_HEIGHT,\n  logicalCanvasWidth: LOGICAL_CANVAS_WIDTH,\n  initialize: sketch.initialize, // delete?\n  windowResized: () => canvas.resizeIfNeeded(),\n  onCanvasResized: sketch.reset,\n  p5Methods: sketch.p5Methods,\n});\n"],"names":["p5ex.canvas","pauseOrResume","startSketch","sketch.initialize","sketch.reset","sketch.p5Methods"],"mappings":"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"}