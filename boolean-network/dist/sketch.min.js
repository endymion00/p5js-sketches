/**
 * Boolean Network.
 * Website => https://www.fal-works.com/
 * Including module: p5ex (Copyright 2018 FAL, licensed under MIT).
 * @copyright 2018 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.0
 * @license CC-BY-SA-3.0
 */
!function(){"use strict";function t(t,e,s,i){return t&&void 0!==e?null===e?new d(t):s?new p(t,e,i):new c(t,e):new u}function e(t){return t.splice(function(t){return Math.floor(Math.random()*t)}(t.length),1)[0]}function s(t){return 1-Math.pow(t-1,2)}function i(t,e,s,i){return t[0]=e,t[1]=s,t[2]=i,t}function n(t){return 255*function(t){return t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055}(Math.min(Math.max(t,0),1))}function o(t,e,s,o){const r=function(t,e,s){const i=(t[0]+16)/116,n=i+t[1]/500,o=i-t[2]/200;return s?(s[0]=e.tristimulusValues[0]*m(n),s[1]=e.tristimulusValues[1]*m(i),s[2]=e.tristimulusValues[2]*m(o),s):[e.tristimulusValues[0]*m(n),e.tristimulusValues[1]*m(i),e.tristimulusValues[2]*m(o)]}(i(y,t,e,s),C,R),a=function(t,e,s){const i=t.length,n=t[0].length,o=s||new Array(i);for(let r=0;r<i;r+=1){o[r]=0;for(let s=0;s<n;s+=1)o[r]+=t[r][s]*e[s]}return o}(S,r,x),h=i(P,n(a[0]),n(a[1]),n(a[2]));return o?[h[0],h[1],h[2],o]:[h[0],h[1],h[2]]}class r{}class a extends r{get width(){return this.rightPositionX-this.leftPositionX}get height(){return this.bottomPositionY-this.topPositionY}get area(){return this.width*this.height}constructor(t,e,s,i,n=0){super(),this.leftPositionX=t-n,this.topPositionY=e-n,this.rightPositionX=s+n,this.bottomPositionY=i+n}contains(t,e=0){return t.x>=this.leftPositionX-e&&t.x<=this.rightPositionX+e&&t.y>=this.topPositionY-e&&t.y<=this.bottomPositionY+e}constrain(t,e=0){t.x<this.leftPositionX-e?t.x=this.leftPositionX-e:t.x>this.rightPositionX+e&&(t.x=this.rightPositionX+e),t.y<this.topPositionY-e?t.y=this.topPositionY-e:t.y>this.bottomPositionY+e&&(t.y=this.bottomPositionY+e)}}class h{constructor(t,e,s,i){this.p=t,this.canvasElement=t.createCanvas(e.scaledWidth,e.scaledHeight,i),this.canvasElement&&"parent"in this.canvasElement&&this.canvasElement.parent(s),this.region=new a(0,0,0,0),this.nonScaledShortSideLength=e.nonScaledShortSideLength,this.updateSize()}get scaleFactor(){return this._scaleFactor}get nonScaledWidth(){return this._nonScaledWidth}get nonScaledHeight(){return this._nonScaledHeight}get aspectRatio(){return this._aspectRatio}resize(t){this.p.resizeCanvas(t.scaledWidth,t.scaledHeight),this.nonScaledShortSideLength=t.nonScaledShortSideLength,this.updateSize()}updateSize(){const t=this.p;this._scaleFactor=Math.min(t.width,t.height)/this.nonScaledShortSideLength,this._inversedScaleFactor=1/this._scaleFactor,this._nonScaledWidth=t.width/this._scaleFactor,this._nonScaledHeight=t.height/this._scaleFactor,this._aspectRatio=t.width/t.height,this.region.rightPositionX=this._nonScaledWidth,this.region.bottomPositionY=this._nonScaledHeight}scale(){this.p.scale(this._scaleFactor)}cancelScale(){this.p.scale(this._inversedScaleFactor)}getNonScaledValueOf(t){return t/this._scaleFactor}}h.DUMMY_PARAMETERS={scaledWidth:100,scaledHeight:100,nonScaledShortSideLength:100};const l={SQUARE640x640:"SQUARE640x640",RECT640x480:"RECT640x480",FULL:"FULL",CUSTOM:"CUSTOM"};class c{constructor(t,e){this.p=t,this.p5Color=e}stroke(){this.p.currentRenderer.stroke(this.p5Color)}fill(){this.p.currentRenderer.fill(this.p5Color)}}class d{constructor(t){this.p=t}stroke(){this.p.currentRenderer.noStroke()}fill(){this.p.currentRenderer.noFill()}}class u{stroke(){}fill(){}}class p{constructor(t,e,s=256){this.p=t;const i=[];for(let n=0;n<s;n+=1)i.push(t.color(t.red(e),t.green(e),t.blue(e),t.alpha(e)*n/(s-1)));this.colorArray=i,this.maxIndex=s-1}stroke(t){this.p.currentRenderer.stroke(this.getColor(t))}fill(t){this.p.currentRenderer.fill(this.getColor(t))}getColor(t){return this.colorArray[t?Math.floor(this.p.map(t,0,255,0,this.maxIndex)):this.maxIndex]}}class g{constructor(e,s,i,n,o){this.strokeColor=t(e,s,n,o),this.fillColor=t(e,i,n,o)}applyColor(t){this.strokeColor.stroke(t),this.fillColor.fill(t)}}g.UNDEFINED=new g(void 0,void 0,void 0);Math.PI;const f=new p5(t=>{t.setup=(()=>{t.noCanvas()})}),m=(Math.PI,f.createVector(),f.createVector(),t=>t>6/29?t*t*t:6/29*3*(6/29)*(t-16/116)),S=[[3.2406255,-1.537208,-.4986286],[-.9689307,1.8757561,.0415175],[.0557101,-.2040211,1.0569959]];class w{constructor(t,e){this.name=t,this.tristimulusValues=e}}let C={D50:new w("D50",[.9642,1,.8251]),D55:new w("D55",[.9568,1,.9214]),D65:new w("D65",[.95047,1,1.08883]),E:new w("E",[1,1,1])}.D50;const y=[0,0,0],R=[0,0,0],x=[0,0,0],P=[0,0,0];class v{constructor(t=256){this.array=new Array(t),this.length=0}get(t){return this.array[t]}getLast(){return this.array[this.length-1]}push(t){return this.array[this.length]=t,this.length+=1,this.length}pushRawArray(t,e=t.length){for(let s=0;s<e;s+=1)this.array[this.length+s]=t[s];return this.length+=e,this.length}pushAll(t){return this.pushRawArray(t.array,t.length)}pop(){return this.length-=1,this.array[this.length]}clear(){this.length=0}loop(t){!function(t,e,s){let i=0;for(;i<s;)e(t[i],i,t),i+=1}(this.array,t,this.length)}loopBackwards(t){!function(t,e,s){for(;s--;)e(t[s],s,t)}(this.array,t,this.length)}roundRobin(t){!function(t,e,s){for(let i=0,n=s-1;i<n;i+=1)for(let o=i+1;o<s;o+=1)e(t[i],t[o])}(this.array,t,this.length)}nestedLoopJoin(t,e){!function(t,e,s,i,n){for(let o=0;o<i;o+=1)for(let i=0;i<n;i+=1)s(t[o],e[i])}(this.array,t.array,e,this.length,t.length)}}class F extends v{constructor(t,e,s){if(super(t*e),this.xCount=t,this.yCount=e,s)for(let i=0,n=t*e;i<n;i+=1)this.push(s)}get2D(t,e){return this.array[t+this.xCount*e]}set2D(t,e,s){this.array[t+this.xCount*e]=s}}class M extends v{static drawFunction(t){t.draw()}draw(){this.loop(M.drawFunction)}}class b extends v{static stepFunction(t){t.step()}step(){this.loop(b.stepFunction)}}class _ extends v{}_.prototype.step=b.prototype.step,_.prototype.draw=M.prototype.draw;class k extends v{constructor(t){super(t),this.recentRemovedElements=new v(t)}clean(){this.recentRemovedElements.clear();let t=0;for(let e=0;e<this.length;e+=1)this.array[e].clean(),this.array[e].isToBeRemoved?this.recentRemovedElements.push(this.array[e]):(this.array[t]=this.array[e],t+=1);this.length=t}}class E extends k{}E.prototype.draw=_.prototype.draw,E.prototype.step=_.prototype.step;f.createVector(),f.createVector(),f.createVector();p5.disableFriendlyErrors=!0;const A=t=>t[0],L=t=>!t[0],W=t=>t[0]&&t[1],V=t=>t[0]||t[1],D=t=>!W(t),N=t=>!V(t),H=t=>t[0]^t[1],T=t=>!H(t),Y=t=>t[0]&&t[1]&&t[2],U=t=>t[0]||t[1]||t[2],I=t=>!Y(t),X=t=>!U(t);class B{constructor(t){this.p=t,this.isNull=!1,this.state=!0,this.predecessorNodes=[],this.previousState=this.state,this.booleanFunction=(t=>!0),this.markScaleFactor=1,this.position=t.createVector(),this.nodeColor=new g(t,null,t.color(function(t,e,s,i){return o(t,e*Math.cos(s),e*Math.sin(s),i)}(70,80,t.random(t.TWO_PI)))),this.markColor=new g(t,t.color(32),null)}step(){const t=this.p.frameCount%this.p.idealFrameRate,e=t/this.p.idealFrameRate;switch(this.markScaleFactor=s(Math.min(5*Math.min(e,1-e),1)),t){case 0:const i=[];for(const t of this.predecessorNodes)i.push(t.state);this.state=this.booleanFunction(i);break;case 1:this.previousState=this.state}}draw(){const t=this.p,e=this.position;if(this.markColor.applyColor(),this.state){t.strokeWeight(4.5);const s=12*this.markScaleFactor;t.line(e.x,e.y-s,e.x,e.y+s)}else{t.strokeWeight(4);const s=20*this.markScaleFactor;t.ellipse(e.x,e.y,s,s)}}setPosition(t){this.position.set(t)}receivesFrom(t){for(const e of this.predecessorNodes)if(e===t)return!0;return!1}setBooleanFunction(){switch(this.predecessorNodes.length){case 0:throw"Found no predecessor nodes.";case 1:this.booleanFunction=this.p.random([A,L]);break;case 2:this.booleanFunction=this.p.random([W,V,D,N,H,H,T,T]);break;default:this.booleanFunction=this.p.random([Y,U,I,X])}}}class z{constructor(t,e,s){this.p=t,this.nodeA=e,this.nodeB=s,this.lineColor=t.color(32),this.onColor=new g(t,null,t.color(96,192,96)),this.offColor=new g(t,null,t.color(128,128,192)),this.startPoint=t.createVector(),this.endPoint=t.createVector()}updatePosition(){const t=this.nodeA.position,e=this.nodeB.position,s=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}(t,e);this.startPoint.set(t.x+35*Math.cos(s),t.y+35*Math.sin(s)),this.endPoint.set(e.x-35*Math.cos(s),e.y-35*Math.sin(s))}step(){}draw(){this.p.stroke(this.lineColor),this.p.strokeWeight(1),this.p.line(this.startPoint.x,this.startPoint.y,this.endPoint.x,this.endPoint.y);const t=this.p.frameCount%this.p.idealFrameRate;if(0===t)return;const e=t/this.p.idealFrameRate,i=function(t){return t<.5?Math.pow(2*t,2)/2:.5+s(2*(t-.5))/2}(e),n=8*Math.sin(Math.PI*e),o=this.p.lerp(this.startPoint.x,this.endPoint.x,i),r=this.p.lerp(this.startPoint.y,this.endPoint.y,i);this.nodeA.state?this.onColor.applyColor():this.offColor.applyColor(),this.p.ellipse(o,r,n,n)}}new class extends p5{setCurrentRenderer(t){this.currentRenderer=t}get nonScaledWidth(){return this.scalableCanvas.nonScaledWidth}get nonScaledHeight(){return this.scalableCanvas.nonScaledHeight}get idealFrameRate(){return this._idealFrameRate}get unitAngleSpeed(){return this._unitAngleSpeed}get unitSpeed(){return this._unitSpeed}get unitAccelerationMagnitude(){return this._unitAccelerationMagnitude}constructor(t,e,s){super(t,"string"==typeof e?document.getElementById(e)||void 0:e,s),this.node=e&&"boolean"!=typeof e?"string"==typeof e?document.getElementById(e)||document.body:e:document.body,this.currentRenderer=this,this.maxCanvasRegion={width:0,height:0,getShortSideLength(){return Math.min(this.width,this.height)}},this.updateMaxCanvasRegion(),this.setFrameRate()}setFrameRate(t=60){return this.frameRate(t),t&&(this._idealFrameRate=t,this._unitAngleSpeed=2*Math.PI/this._idealFrameRate,this._unitSpeed=1/this._idealFrameRate,this._unitAccelerationMagnitude=this._unitSpeed/this._idealFrameRate),this}updateMaxCanvasRegion(){if(this.maxCanvasRegion.width=this.windowWidth,this.maxCanvasRegion.height=this.windowHeight,this.node===document.body)return;const t=this.node.getBoundingClientRect();this.maxCanvasRegion.width=t.width,this.maxCanvasRegion.height=t.height}createScalableCanvas(t,e,s){this.scalableCanvasType=t,this.scalableCanvas=new h(this,this.createScalableCanvasParameter(t,e),this.node,s)}resizeScalableCanvas(t,e){this.scalableCanvas.resize(this.createScalableCanvasParameter(t||this.scalableCanvasType,e))}createScalableCanvasParameter(t,e){this.updateMaxCanvasRegion();const s=this.maxCanvasRegion.getShortSideLength();switch(t){case l.SQUARE640x640:return{scaledWidth:s,scaledHeight:s,nonScaledShortSideLength:640};case l.RECT640x480:return{scaledWidth:s,scaledHeight:.75*s,nonScaledShortSideLength:480};case l.FULL:return{scaledWidth:this.maxCanvasRegion.width,scaledHeight:this.maxCanvasRegion.height,nonScaledShortSideLength:640};default:return e||h.DUMMY_PARAMETERS}}}(t=>{function s(t,e,s,i,n,o=!1){let r=null,a=e,h=s;for(;null===r&&!((a+=i)<0||a>=t.xCount)&&!((h+=n)<0||h>=t.yCount);){const e=t.get2D(a,h);e.isNull||(r=e)}return r}function i(t,e,i){const n=[],o=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];for(const r of o){const o=s(t,e,i,r[0],r[1]);o&&n.push(o)}return n}function n(s=5,n=5,o=7){c.clear(),d.clear();const r=new F(s,n,new B(t));for(let e=0;e<r.length;e+=1)r.array[e]=new B(t);const a=r.array.slice(0,r.length);for(let t=0;t<o;t+=1)e(a).isNull=!0;for(let h=0;h<s;h+=1){const o=(1+h)*(t.nonScaledWidth/(s+1));for(let s=0;s<n;s+=1){const a=r.get2D(h,s);if(a.isNull)continue;const l=(1+s)*(t.nonScaledHeight/(n+1));a.setPosition(t.createVector(o,l));const u=i(r,h,s),p=Math.min(t.random([1,2,3]),u.length);for(;a.predecessorNodes.length<p;){if(u.length<=0)return!1;const s=e(u),i=new z(t,s,a);s.receivesFrom(a)||(a.predecessorNodes.push(s),d.push(i))}c.push(a)}}return!0}function o(){let t=0;for(;!n();)if((t+=1)>1e3)throw"Could not create a valid boolean network.";c.loop(t=>{t.setBooleanFunction()}),d.loop(t=>{t.updatePosition()})}function r(){t.background(255),function(t,e,s,i,n=1){const o=t.currentRenderer;o.background(e),o.strokeWeight(2);for(let r=0;r<o.width;r+=1){const e=Math.pow(r/(o.height-1),n);o.stroke(t.lerpColor(s,i,e)),o.line(0,r,o.width-1,r)}}(t,t.color(255),t.color(255),t.color(248,248,252),2),t.loadPixels(),a=t.pixels,o()}let a,h=-1;const c=new _(16),d=new _;t.preload=(()=>{}),t.setup=(()=>{t.createScalableCanvas(l.SQUARE640x640),t.setFrameRate(60),t.rectMode(t.CENTER),r()}),t.draw=(()=>{t.pixels=a,t.updatePixels(),t.scalableCanvas.scale(),c.step(),d.step(),d.draw(),c.draw(),t.scalableCanvas.cancelScale()}),t.windowResized=(()=>{t.resizeScalableCanvas(),-1!==h&&clearTimeout(h),h=setTimeout(()=>{r()},200)}),t.mouseClicked=(()=>{o()})},"BooleanNetwork")}();