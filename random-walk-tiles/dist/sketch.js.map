{"version":3,"file":"sketch.js","sources":["../src/common.ts","../src/settings.ts","../src/tile.ts","../src/tiles.ts","../src/sketch.ts","../src/main.ts"],"sourcesContent":["/**\n * ---- Common ----------------------------------------------------------------\n */\n\nimport p5 from \"p5\";\nimport * as CCC from \"@fal-works/creative-coding-core\";\nimport * as p5ex from \"@fal-works/p5-extension\";\n\nexport const { Numeric, ArrayList, HSV, Random, Easing } = CCC;\n\nexport const { onSetup, onInstantiate } = p5ex;\n\n/**\n * Shared p5 instance.\n */\nexport let p: p5;\n\nonInstantiate.push((p5Instance) => {\n  p = p5Instance;\n});\n\n/**\n * Shared canvas instance.\n */\nexport let canvas: p5ex.ScaledCanvas;\n\n/**\n * Alias for `p.drawingContext`.\n */\nexport let context: CanvasRenderingContext2D;\n\nonSetup.push(() => {\n  canvas = p5ex.canvas;\n  context = (p as any).drawingContext; // eslint-disable-line\n});\n\nexport const resetCommon = () => {};\n","/**\n * ---- Settings --------------------------------------------------------------\n */\n\n/** The id of the HTML element to which the canvas should belong. */\nexport const HTML_ELEMENT_ID = \"RandomWalkTiles\";\n\n/** The logical height of the canvas. */\nexport const LOGICAL_CANVAS_HEIGHT = 1080;\n","/**\n * ---- Tile ------------------------------------------------------------------\n */\n\nimport { p, HSV, Random, Numeric, Easing, context } from \"./common\";\n\nexport const size = 36;\nconst drawSize = 28;\nconst radius = 4;\nconst easeAlpha = Easing.concatenate(\n  (v) => Numeric.square(v),\n  (v) => 1 - Numeric.cube(v),\n  0.15\n);\n\nexport interface Unit {\n  x: number;\n  y: number;\n  hue: number;\n  rgb: readonly number[];\n  progress: number;\n  progressRate: number;\n}\n\nexport const create = (x: number, y: number, hue: number): Unit => {\n  return {\n    x,\n    y,\n    hue,\n    rgb: HSV.toRGB([\n      (hue + Random.Curved.signed(Numeric.cube, 150) + 360) % 360,\n      0.8,\n      0.98,\n    ]).map((v) => 255 * v),\n    progress: 0,\n    progressRate: 0.01,\n  };\n};\n\nexport const update = (tile: Unit): boolean => {\n  const nextProgress = tile.progress + tile.progressRate;\n\n  if (nextProgress >= 1) return true;\n  else {\n    tile.progress = nextProgress;\n    return false;\n  }\n};\n\nexport const draw = (tile: Unit): void => {\n  const { rgb } = tile;\n  const alpha = 192 * easeAlpha(tile.progress);\n  const color = p.color(rgb[0], rgb[1], rgb[2], alpha);\n  p.fill(color);\n  context.shadowColor = `rgba(${rgb[0]}, ${rgb[1]}, ${rgb[2]}, ${0.2 * alpha})`;\n  p.rect(tile.x, tile.y, drawSize, drawSize, radius);\n};\n","/**\n * ---- Tiles -----------------------------------------------------------------\n */\n\nimport { ArrayList } from \"./common\";\nimport * as Tile from \"./tile\";\n\nconst list = ArrayList.create<Tile.Unit>(256);\nconst grid: Tile.Unit[][] = [];\n\nexport const reset = () => {\n  ArrayList.clearReference(list);\n  while (grid.length > 0) grid.pop();\n};\n\nexport const add = (tile: Tile.Unit) => {\n  const x = Math.floor(tile.x / Tile.size);\n  const y = Math.floor(tile.y / Tile.size);\n  if (grid[x] == undefined) grid[x] = [];\n\n  const existingTile = grid[x][y];\n  if (existingTile != undefined) existingTile.progressRate = 0.1;\n\n  ArrayList.add(list, tile);\n  grid[x][y] = tile;\n};\n\nexport const update = () => ArrayList.removeSwapAll(list, Tile.update);\n\nexport const draw = () => ArrayList.loop(list, Tile.draw);\n","/**\n * ---- Sketch ----------------------------------------------------------------\n */\n\nimport { storePixels, pauseOrResume } from \"@fal-works/p5-extension\";\nimport { p, canvas, resetCommon, Random, context } from \"./common\";\nimport * as Tile from \"./tile\";\nimport * as Tiles from \"./tiles\";\n\n// ---- variables | functions ----\nlet drawBackground: () => void;\nlet lastTile: Tile.Unit;\n\n// ---- reset & initialize ----\nexport const reset = () => {\n  p.blendMode(p.REPLACE);\n  p.background(252);\n  drawBackground = storePixels();\n  p.blendMode(p.DARKEST);\n\n  resetCommon();\n  Tiles.reset();\n\n  const canvasSize = canvas.logicalSize;\n  const x = 0.5 * canvasSize.width;\n  const y = 0.5 * canvasSize.height;\n  lastTile = Tile.create(x, y, Random.value(360));\n};\n\nexport const initialize = (): void => {\n  reset();\n  p.noStroke();\n  p.rectMode(p.CENTER);\n\n  context.shadowOffsetX = 6;\n  context.shadowOffsetY = 6;\n  context.shadowBlur = 16;\n};\n\n// ---- draw ----\n\nconst addNewTile = () => {\n  let x = 0;\n  let y = 0;\n  let horizontal, vertical: number;\n  const { width, height } = canvas.logicalSize;\n  const minX = 0.1 * width;\n  const maxX = 0.9 * width;\n  const minY = 0.1 * height;\n  const maxY = 0.9 * height;\n  let searchingNextPosition = true;\n\n  while (searchingNextPosition) {\n    switch (Random.Integer.value(4)) {\n      default:\n      case 0:\n        horizontal = -1;\n        vertical = 0;\n        break;\n      case 1:\n        horizontal = 0;\n        vertical = -1;\n        break;\n      case 2:\n        horizontal = 1;\n        vertical = 0;\n        break;\n      case 3:\n        horizontal = 0;\n        vertical = 1;\n        break;\n    }\n\n    x = lastTile.x + horizontal * Tile.size;\n    y = lastTile.y + vertical * Tile.size;\n\n    if (x >= minX && x < maxX && y >= minY && y < maxY)\n      searchingNextPosition = false;\n  }\n\n  const hue = (lastTile.hue + 2) % 360;\n\n  const nextTile = Tile.create(x, y, hue);\n  Tiles.add(nextTile);\n\n  lastTile = nextTile;\n};\n\nconst updateSketch = () => {\n  Tiles.update();\n  for (let i = 0; i < 2; i += 1) addNewTile();\n};\n\nconst drawSketch = () => {\n  Tiles.draw();\n};\n\nconst draw = (): void => {\n  updateSketch();\n\n  drawBackground();\n  canvas.drawScaled(drawSketch);\n};\n\n// ---- UI ----\n\nconst keyTyped = () => {\n  switch (p.key) {\n    case \"p\":\n      pauseOrResume();\n      break;\n    case \"g\":\n      p.save(\"image.png\");\n      break;\n    case \"r\":\n      reset();\n      break;\n  }\n\n  return false;\n};\n\n// ---- p5 methods ----\n\nexport const p5Methods = {\n  draw,\n  keyTyped,\n};\n","/**\n * ---- Main ------------------------------------------------------------------\n */\n\nimport { startSketch } from \"@fal-works/p5-extension\";\n\nimport { canvas } from \"./common\";\nimport { HTML_ELEMENT_ID, LOGICAL_CANVAS_HEIGHT } from \"./settings\";\nimport * as sketch from \"./sketch\";\n\n// ---- start sketch ----\n\nstartSketch({\n  htmlElement: HTML_ELEMENT_ID,\n  logicalCanvasHeight: LOGICAL_CANVAS_HEIGHT,\n  initialize: sketch.initialize, // delete?\n  windowResized: () => canvas.resizeIfNeeded(),\n  onCanvasResized: sketch.reset,\n  p5Methods: sketch.p5Methods,\n});\n"],"names":["p5ex.canvas","Tile.size","update","Tile.update","draw","Tile.draw","reset","storePixels","Tiles.reset","Tile.create","Tiles.add","Tiles.update","Tiles.draw","pauseOrResume","startSketch","sketch.initialize","sketch.reset","sketch.p5Methods"],"mappings":"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"}