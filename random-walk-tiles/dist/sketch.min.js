/**
 * Random Walk Tiles.
 * Source code in TypeScript: https://github.com/fal-works/p5js-sketches/tree/master/random-walk-tiles

 * @copyright 2020 FAL
 * @version 0.1.0
 */
!function(e,s){"use strict";const{Numeric:a,Arrays:t,ArrayList:r,HSV:o,Random:n,Easing:c}=s,{onSetup:l,onInstantiate:i}=e;let d,g,u;i.push(e=>{d=e}),l.push(()=>{g=e.canvas,u=d.drawingContext});const h=c.concatenate(e=>a.square(e),e=>1-a.cube(e),.15),p=(e,s,t)=>({x:e,y:s,hue:t,rgb:o.toRGB([(t+n.Curved.signed(a.cube,150)+360)%360,.8,.98]).map(e=>255*e),progress:0,progressRate:.01}),w=e=>{const s=e.progress+e.progressRate;return s>=1||(e.progress=s,!1)},b=e=>{const{rgb:s}=e,a=192*h(e.progress),t=d.color(s[0],s[1],s[2],a);d.fill(t),u.shadowColor=`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${.2*a})`,d.rect(e.x,e.y,28,28,4)},f=r.create(256),k=[];let R,m;const v=()=>{d.background(252),R=e.storePixels()},y=()=>{let e,s,a=0,t=0;const{width:o,height:c}=g.logicalSize,l=.1*o,i=.9*o,d=.1*c,u=.9*c;let h=!0;for(;h;){switch(n.Integer.value(4)){default:case 0:e=-1,s=0;break;case 1:e=0,s=-1;break;case 2:e=1,s=0;break;case 3:e=0,s=1}a=m.x+36*e,t=m.y+36*s,a>=l&&a<i&&t>=d&&t<u&&(h=!1)}const w=(m.hue+2)%360,b=p(a,t,w);(e=>{const s=Math.floor(e.x/36),a=Math.floor(e.y/36);null==k[s]&&(k[s]=[]);const t=k[s][a];null!=t&&(t.progressRate=.1),r.add(f,e),k[s][a]=e})(b),m=b},C=()=>{r.removeSwapAll(f,w);for(let e=0;e<2;e+=1)y()},S=()=>{r.loop(f,b)},x={draw:()=>{C(),R(),g.drawScaled(S)},keyTyped:()=>{switch(d.key){case"p":e.pauseOrResume();break;case"g":d.save("image.png");break;case"r":v()}return!1}};e.startSketch({htmlElement:"RandomWalkTiles",logicalCanvasHeight:1080,initialize:()=>{v(),d.noStroke(),d.rectMode(d.CENTER),d.blendMode(d.DARKEST),u.shadowOffsetX=6,u.shadowOffsetY=6,u.shadowBlur=16;const e=g.logicalSize,s=.5*e.width,a=.5*e.height;m=p(s,a,n.value(360))},windowResized:()=>g.resizeIfNeeded(),onCanvasResized:v,p5Methods:x})}(p5ex,CreativeCodingCore);