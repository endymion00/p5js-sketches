/**
 * Random Walk Tiles.
 * Source code in TypeScript: https://github.com/fal-works/p5js-sketches/tree/master/random-walk-tiles
 *
 * @copyright 2020 FAL
 * @version 0.1.0
 */
!function(e,s){"use strict";const{Numeric:a,ArrayList:t,HSV:o,Random:r,Easing:n}=s,{onSetup:c,onInstantiate:l}=e;let i,d,g;l.push(e=>{i=e}),c.push(()=>{d=e.canvas,g=i.drawingContext});const h=n.concatenate(e=>a.square(e),e=>1-a.cube(e),.15),u=(e,s,t)=>({x:e,y:s,hue:t,rgb:o.toRGB([(t+r.Curved.signed(a.cube,150)+360)%360,.8,.98]).map(e=>255*e),progress:0,progressRate:.01}),p=e=>{const s=e.progress+e.progressRate;return s>=1||(e.progress=s,!1)},f=e=>{const{rgb:s}=e,a=192*h(e.progress),t=i.color(s[0],s[1],s[2],a);i.fill(t),g.shadowColor=`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${.2*a})`,i.rect(e.x,e.y,28,28,4)},w=t.create(256),b=[];let R,k;const C=()=>{i.blendMode(i.REPLACE),i.background(252),R=e.storePixels(),i.blendMode(i.DARKEST),(()=>{for(t.clearReference(w);b.length>0;)b.pop()})();const s=d.logicalSize,a=.5*s.width,o=.5*s.height;k=u(a,o,r.value(360))},m=()=>{let e,s,a=0,o=0;const{width:n,height:c}=d.logicalSize,l=.1*n,i=.9*n,g=.1*c,h=.9*c;let p=!0;for(;p;){switch(r.Integer.value(4)){default:case 0:e=-1,s=0;break;case 1:e=0,s=-1;break;case 2:e=1,s=0;break;case 3:e=0,s=1}a=k.x+36*e,o=k.y+36*s,a>=l&&a<i&&o>=g&&o<h&&(p=!1)}const f=(k.hue+2)%360,R=u(a,o,f);(e=>{const s=Math.floor(e.x/36),a=Math.floor(e.y/36);null==b[s]&&(b[s]=[]);const o=b[s][a];null!=o&&(o.progressRate=.1),t.add(w,e),b[s][a]=e})(R),k=R},v=()=>{t.removeSwapAll(w,p);for(let e=0;e<2;e+=1)m()},S=()=>{t.loop(w,f)},y={draw:()=>{v(),R(),d.drawScaled(S)},keyTyped:()=>{switch(i.key){case"p":e.pauseOrResume();break;case"g":i.save("image.png");break;case"r":C()}return!1}};e.startSketch({htmlElement:"RandomWalkTiles",logicalCanvasHeight:1080,initialize:()=>{C(),i.noStroke(),i.rectMode(i.CENTER),g.shadowOffsetX=6,g.shadowOffsetY=6,g.shadowBlur=16},windowResized:()=>d.resizeIfNeeded(),onCanvasResized:C,p5Methods:y})}(p5ex,CreativeCodingCore);