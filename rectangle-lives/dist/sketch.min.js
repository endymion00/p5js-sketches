/**
 * Rectangle Lives.
 * Website => https://www.fal-works.com/
 * Including module: p5ex (Copyright 2018 FAL, licensed under MIT).
 * @copyright 2018 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.2.0
 * @license CC-BY-SA-3.0
 */
var rectangleLives=function(){"use strict";class t{}class e extends t{get width(){return this.rightPositionX-this.leftPositionX}get height(){return this.bottomPositionY-this.topPositionY}get area(){return this.width*this.height}constructor(t,e,i,s,r=0){super(),this.leftPositionX=t-r,this.topPositionY=e-r,this.rightPositionX=i+r,this.bottomPositionY=s+r}contains(t,e=0){return t.x>=this.leftPositionX-e&&t.x<=this.rightPositionX+e&&t.y>=this.topPositionY-e&&t.y<=this.bottomPositionY+e}constrain(t,e=0){t.x<this.leftPositionX-e?t.x=this.leftPositionX-e:t.x>this.rightPositionX+e&&(t.x=this.rightPositionX+e),t.y<this.topPositionY-e?t.y=this.topPositionY-e:t.y>this.bottomPositionY+e&&(t.y=this.bottomPositionY+e)}}class i{constructor(t,i,s,r){this.p=t,this.canvasElement=t.createCanvas(i.scaledWidth,i.scaledHeight,r),this.canvasElement&&"parent"in this.canvasElement&&this.canvasElement.parent(s),this.region=new e(0,0,0,0),this.nonScaledShortSideLength=i.nonScaledShortSideLength,this.updateSize()}get scaleFactor(){return this._scaleFactor}get nonScaledWidth(){return this._nonScaledWidth}get nonScaledHeight(){return this._nonScaledHeight}get aspectRatio(){return this._aspectRatio}resize(t){this.p.resizeCanvas(t.scaledWidth,t.scaledHeight),this.nonScaledShortSideLength=t.nonScaledShortSideLength,this.updateSize()}updateSize(){const t=this.p;this._scaleFactor=Math.min(t.width,t.height)/this.nonScaledShortSideLength,this._inversedScaleFactor=1/this._scaleFactor,this._nonScaledWidth=t.width/this._scaleFactor,this._nonScaledHeight=t.height/this._scaleFactor,this._aspectRatio=t.width/t.height,this.region.rightPositionX=this._nonScaledWidth,this.region.bottomPositionY=this._nonScaledHeight}scale(){this.p.scale(this._scaleFactor)}cancelScale(){this.p.scale(this._inversedScaleFactor)}getNonScaledValueOf(t){return t/this._scaleFactor}}i.DUMMY_PARAMETERS={scaledWidth:100,scaledHeight:100,nonScaledShortSideLength:100};const s={SQUARE640x640:"SQUARE640x640",RECT640x480:"RECT640x480",FULL:"FULL",CUSTOM:"CUSTOM"};class r{constructor(t,e){this.p=t,this.p5Color=e}stroke(){this.p.currentRenderer.stroke(this.p5Color)}fill(){this.p.currentRenderer.fill(this.p5Color)}}class n{constructor(t){this.p=t}stroke(){this.p.currentRenderer.noStroke()}fill(){this.p.currentRenderer.noFill()}}class o{stroke(){}fill(){}}class l{constructor(t,e,i=256){this.p=t;const s=[];for(let r=0;r<i;r+=1)s.push(t.color(t.red(e),t.green(e),t.blue(e),t.alpha(e)*r/(i-1)));this.colorArray=s,this.maxIndex=i-1}stroke(t){this.p.currentRenderer.stroke(this.getColor(t))}fill(t){this.p.currentRenderer.fill(this.getColor(t))}getColor(t){return this.colorArray[t?Math.floor(this.p.map(t,0,255,0,this.maxIndex)):this.maxIndex]}}function a(t,e,i,s){return t&&void 0!==e?null===e?new n(t):i?new l(t,e,s):new r(t,e):new o}class h{constructor(t,e,i,s,r){this.strokeColor=a(t,e,s,r),this.fillColor=a(t,i,s,r)}applyColor(t){this.strokeColor.stroke(t),this.fillColor.fill(t)}}h.UNDEFINED=new h(void 0,void 0,void 0);const c=()=>{},d=(Math.PI,new p5(t=>{t.setup=(()=>{t.noCanvas()})}));Math.PI,d.createVector(),d.createVector();class u{constructor(t=0){this.value=t}valueOf(){return this.value}}u.NULL=new u;class g{constructor(t=256){this.array=new Array(t),this.length=0}get(t){return this.array[t]}getLast(){return this.array[this.length-1]}push(t){return this.array[this.length]=t,this.length+=1,this.length}pushRawArray(t,e=t.length){for(let i=0;i<e;i+=1)this.array[this.length+i]=t[i];return this.length+=e,this.length}pushAll(t){return this.pushRawArray(t.array,t.length)}pop(){return this.length-=1,this.array[this.length]}clear(){this.length=0}loop(t){!function(t,e,i){let s=0;for(;s<i;)e(t[s],s,t),s+=1}(this.array,t,this.length)}loopBackwards(t){!function(t,e,i){for(;i--;)e(t[i],i,t)}(this.array,t,this.length)}roundRobin(t){!function(t,e,i){for(let s=0,r=i-1;s<r;s+=1)for(let n=s+1;n<i;n+=1)e(t[s],t[n])}(this.array,t,this.length)}nestedLoopJoin(t,e){!function(t,e,i,s,r){for(let n=0;n<s;n+=1)for(let s=0;s<r;s+=1)i(t[n],e[s])}(this.array,t.array,e,this.length,t.length)}}class p extends g{constructor(t,e,i){if(super(t*e),this.xCount=t,this.yCount=e,i)for(let s=0,r=t*e;s<r;s+=1)this.push(i)}get2D(t,e){return this.array[t+this.xCount*e]}set2D(t,e,i){this.array[t+this.xCount*e]=i}}const C=new class{getNeighborCell(t,e){return this}setNeighborCell(t,e,i){}};class y{constructor(t=1){this.neighborCells=new p(2*t+1,2*t+1,C)}getNeighborCell(t,e){const i=Math.floor(this.neighborCells.xCount/2);return t<-i||t>i||e<-i||e>i?C:this.neighborCells.get2D(t+i,e+i)}setNeighborCell(t,e,i){const s=Math.floor(this.neighborCells.xCount/2);this.neighborCells.set2D(t+s,e+s,i)}}class x{constructor(t,e,i,s,r,n){this.nullCell=n,this.cell2DArray=new p(t,e,n),this.cellIndexMap=new Map;for(let o=0;o<e;o+=1)for(let e=0;e<t;e+=1){const t=r(i);this.cell2DArray.set2D(e,o,t),this.cellIndexMap.set(t,{x:e,y:o})}this.cell2DArray.loop(t=>{this.setNeighborCells(t,i,s)})}getCell(t,e){return this.cell2DArray.get2D(t,e)}getCellIndex(t){return this.cellIndexMap.get(t)||{x:-1,y:-1}}getRelativePositionCell(t,e,i,s){if(t===this.nullCell)return t;if(0===e&&0===i)return t;const r=this.getCellIndex(t),n={x:r.x+e,y:r.y+i};if(s)n.x<0?n.x+=this.cell2DArray.xCount:n.x>=this.cell2DArray.xCount&&(n.x-=this.cell2DArray.xCount),n.y<0?n.y+=this.cell2DArray.yCount:n.y>=this.cell2DArray.yCount&&(n.y-=this.cell2DArray.yCount);else if(n.x<0||n.x>=this.cell2DArray.xCount||n.y<0||n.y>=this.cell2DArray.yCount)return this.nullCell;return this.cell2DArray.get2D(n.x,n.y)}setNeighborCells(t,e,i){for(let s=-e;s<=e;s+=1)for(let r=-e;r<=e;r+=1)t.setNeighborCell(s,r,this.getRelativePositionCell(t,s,r,i))}}class m extends g{static drawFunction(t){t.draw()}draw(){this.loop(m.drawFunction)}}class S extends g{static stepFunction(t){t.step()}step(){this.loop(S.stepFunction)}}class v extends g{}v.prototype.step=S.prototype.step,v.prototype.draw=m.prototype.draw;class f extends g{constructor(t){super(t),this.recentRemovedElements=new g(t)}clean(){this.recentRemovedElements.clear();let t=0;for(let e=0;e<this.length;e+=1)this.array[e].clean(),this.array[e].isToBeRemoved?this.recentRemovedElements.push(this.array[e]):(this.array[t]=this.array[e],t+=1);this.length=t}}class w extends f{}w.prototype.draw=v.prototype.draw,w.prototype.step=v.prototype.step;d.createVector(),d.createVector(),d.createVector();class A{constructor(){this.count=0}resetCount(t=0){return this.count=t,this}step(){this.count+=1}mod(t){return this.count%t}}class b extends A{get isOn(){return this._isOn}constructor(t,e=c){super(),this._isOn=!0,this.completeBehavior=e,this.durationFrameCount=t}on(t){return this._isOn=!0,t&&(this.durationFrameCount=t),this}off(){return this._isOn=!1,this}step(){this._isOn&&(this.count+=1,this.count>this.durationFrameCount&&this.completeCycle())}}class P extends b{get isCompleted(){return this._isCompleted}constructor(t,e){super(t,e),this._isCompleted=!1}on(t){return super.on(t),this}off(){return super.off(),this}resetCount(){return super.resetCount(),this._isCompleted=!1,this}getProgressRatio(){return this._isCompleted?1:this.count/this.durationFrameCount}completeCycle(){this._isCompleted=!0,this._isOn=!1,this.completeBehavior()}}function R(t,e,i,s,r,n,o){const l=t,a=l.width*l.pixelDensity();for(let h=0;h<s;h+=1)for(let t=0;t<s;t+=1){const s=4*((i+t)*a+(e+h));l.pixels[s]=r,l.pixels[s+1]=n,l.pixels[s+2]=o}}const F={alive:{red:48,green:48,blue:48},dying:{red:t=>192+60*t,green:t=>192+60*t,blue:t=>255},background:[252,252,255]};class D extends y{constructor(t,e=10){super(1),this.p=t,this.isAlive=!1,this.willBeAlive=!1,this.position=t.createVector(),this.deathTimer=new P(e).off()}step(){this.deathTimer.isOn&&(this.deathTimer.step(),this.grid.dyingCells.push(this))}determineNextState(){if(!this.isAlive)return this.willBeAlive=this.grid.data.rule.birth[this.countAliveNeighbors()],void(this.willBeAlive&&this.grid.cellsToChange.push(this));this.willBeAlive=this.grid.data.rule.survival[this.countAliveNeighbors()],this.willBeAlive||this.grid.cellsToChange.push(this)}gotoNextState(){this.willBeAlive?this.setAlive():this.setDead()}countAliveNeighbors(){let t=0;const e=this.neighborCells.array;for(let i=0;i<9;i+=1)4!==i&&e[i].isAlive&&(t+=1);return t}setAlive(){this.isAlive||(this.deathTimer.resetCount().off(),this.isAlive=!0,this.grid.bornCells.push(this))}setDead(){this.isAlive&&(this.deathTimer.on(),this.isAlive=!1)}}function _(t){return t.replace(/[^\d]/g,"").split("").map(Number)}function I(t,e){const i=Array(e);for(let s=0;s<=e;s+=1)i[s]=t.indexOf(s)>=0;return i}function M(t){let e="",i=!1,s=100,r=100;const n={birth:I([3],8),survival:I([2,3],8)};for(let o=0,l=t.length;o<l;o+=1){const l=t[o];if("#"===l.charAt(0))continue;if(i){e+=l;continue}const a=l.match(/x\s*=\s*\d+/);if(a){const t=a[0].match(/\d+/);t&&(s=parseInt(t[0],10))}const h=l.match(/y\s*=\s*\d+/);if(h){const t=h[0].match(/\d+/);t&&(r=parseInt(t[0],10))}const c=l.match(/rule\s*=.*/);if(c){const t=c[0].match(/B[\s\d]+/);t&&(n.birth=I(_(t[0]),8));const e=c[0].match(/S[\s\d]+/);e&&(n.survival=I(_(e[0]),8))}i=!0}return{initialCells:function(t){const e=t.replace(/^#.*$/g,""),i=[];let s=0,r=0,n=0;for(let o=0;o<e.length;o+=1){const t=e[o],l=s<o&&e.slice(s,o),a=l?parseInt(l,10):1;if("o"===t)for(let e=0;e<a;e+=1)i.push(r,n),r+=1;else"b"===t?r+=a:"$"===t?(n+=a,r=0):"x"!==t&&"y"!==t||(o=e.indexOf("\n",o));"o"!==t&&"b"!==t&&"$"!==t&&"x"!==t&&"y"!==t||(s=o+1)}return i}(e),cellCountX:s,cellCountY:r,rule:n}}p5.disableFriendlyErrors=!0;return t=>{new class extends p5{setCurrentRenderer(t){this.currentRenderer=t}get nonScaledWidth(){return this.scalableCanvas.nonScaledWidth}get nonScaledHeight(){return this.scalableCanvas.nonScaledHeight}get idealFrameRate(){return this._idealFrameRate}get unitAngleSpeed(){return this._unitAngleSpeed}get unitSpeed(){return this._unitSpeed}get unitAccelerationMagnitude(){return this._unitAccelerationMagnitude}constructor(t,e,i){super(t,"string"==typeof e?document.getElementById(e)||void 0:e,i),this.node=e&&"boolean"!=typeof e?"string"==typeof e?document.getElementById(e)||document.body:e:document.body,this.currentRenderer=this,this.maxCanvasRegion={width:0,height:0,getShortSideLength(){return Math.min(this.width,this.height)}},this.updateMaxCanvasRegion(),this.setFrameRate()}setFrameRate(t=60){return this.frameRate(t),t&&(this._idealFrameRate=t,this._unitAngleSpeed=2*Math.PI/this._idealFrameRate,this._unitSpeed=1/this._idealFrameRate,this._unitAccelerationMagnitude=this._unitSpeed/this._idealFrameRate),this}updateMaxCanvasRegion(){if(this.maxCanvasRegion.width=this.windowWidth,this.maxCanvasRegion.height=this.windowHeight,this.node===document.body)return;const t=this.node.getBoundingClientRect();this.maxCanvasRegion.width=t.width,this.maxCanvasRegion.height=t.height}createScalableCanvas(t,e,s){this.scalableCanvasType=t,this.scalableCanvas=new i(this,this.createScalableCanvasParameter(t,e),this.node,s)}resizeScalableCanvas(t,e){this.scalableCanvas.resize(this.createScalableCanvasParameter(t||this.scalableCanvasType,e))}createScalableCanvasParameter(t,e){this.updateMaxCanvasRegion();const r=this.maxCanvasRegion.getShortSideLength();switch(t){case s.SQUARE640x640:return{scaledWidth:r,scaledHeight:r,nonScaledShortSideLength:640};case s.RECT640x480:return{scaledWidth:r,scaledHeight:.75*r,nonScaledShortSideLength:480};case s.FULL:return{scaledWidth:this.maxCanvasRegion.width,scaledHeight:this.maxCanvasRegion.height,nonScaledShortSideLength:640};default:return e||i.DUMMY_PARAMETERS}}}(e=>{let i,r;e.preload=(()=>{console.log("Loading "+t.rlePath+" ..."),e.loadStrings(t.rlePath,e=>{console.log("Loaded."),console.log("Parsing "+t.rlePath+" ..."),i=M(e),console.log("Parsed.")})}),e.setup=(()=>{e.createScalableCanvas(s.FULL),e.setFrameRate(t.frameRate||30),e.noStroke();const n=(r=new class extends x{constructor(t,e,i=F,s=10,r=0,n=!1){super(e.cellCountX+2*r,e.cellCountY+2*r,1,n,e=>new D(t,s),new D(t)),this.p=t,this.data=e,this.color=i,this.cellPixelSize=new u(1),this.generationIntervalFrameCount=1,this.generationPreparationFrameCount=0,this.drawBornCell=(t=>{const e=this.cellPixelSize.value,i=this.color.alive;R(this.p,t.xIndex*e,t.yIndex*e,e,i.red,i.green,i.blue)}),this.drawDyingCell=(t=>{const e=this.cellPixelSize.value,i=this.color.dying,s=t.deathTimer.getProgressRatio();R(this.p,t.xIndex*e,t.yIndex*e,e,i.red(s,t.yIndex,this.cell2DArray.yCount),i.green(s,t.yIndex,this.cell2DArray.yCount),i.blue(s,t.yIndex,this.cell2DArray.yCount))}),this.cellsToChange=new g(this.cell2DArray.length),this.bornCells=new g(this.cell2DArray.length),this.dyingCells=new g(this.cell2DArray.length),this.cell2DArray.loop(t=>{t.grid=this;const e=this.getCellIndex(t);t.xIndex=e.x,t.yIndex=e.y}),this.updateSize();for(let o=0,l=e.initialCells.length;o<l;o+=2){const t=this.getCell(e.initialCells[o]+r,e.initialCells[o+1]+r);t&&t.setAlive()}this.generationPreparationCellsPerFrame=Math.ceil(this.cell2DArray.length/this.generationIntervalFrameCount),this.generationIntervalFrameCount>1?(this.stepCell=(t=>{t.step()}),this.prepareNextGeneration=(()=>{const t=this.cell2DArray.array,e=this.generationPreparationCellsPerFrame*this.generationPreparationFrameCount,i=Math.min(this.generationPreparationCellsPerFrame*(this.generationPreparationFrameCount+1),this.cell2DArray.length);for(let s=e;s<i;s+=1)t[s].determineNextState();this.generationPreparationFrameCount+=1,this.generationPreparationFrameCount>=this.generationIntervalFrameCount&&(this.cellsToChange.loop(this.gotoNextState),this.cellsToChange.clear(),this.generationPreparationFrameCount=0)})):(this.stepCell=(t=>{t.step(),t.determineNextState()}),this.prepareNextGeneration=(()=>{this.cellsToChange.loop(this.gotoNextState),this.cellsToChange.clear()}))}updateSize(){this.cellPixelSize.value=Math.floor(this.p.pixelDensity()*Math.min(this.p.width/this.cell2DArray.xCount,this.p.height/this.cell2DArray.yCount))}step(){this.cell2DArray.loop(this.stepCell),this.prepareNextGeneration()}draw(){this.dyingCells.loop(this.drawDyingCell),this.dyingCells.clear(),this.bornCells.loop(this.drawBornCell),this.bornCells.clear()}gotoNextState(t){t.gotoNextState()}}(e,i,t.color,t.afterImageFrameCount,t.marginCells,t.torusMode)).color.background;e.background(n[0],n[1],n[2]),e.loadPixels()}),e.draw=(()=>{r.step(),r.draw(),e.updatePixels()}),e.windowResized=(()=>{}),e.mousePressed=(()=>{}),e.touchMoved=(()=>{})},t.htmlElementId||"RectangleLives")}}();