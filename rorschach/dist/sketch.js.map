{"version":3,"file":"sketch.js","sources":["../src/RorschachShape.ts","../src/main.ts"],"sourcesContent":["import * as p5ex from \"p5ex\";\r\n\r\nexport class RorschachShape implements p5ex.Sprite {\r\n  private static temporalVector: p5.Vector;\r\n  private static isNotInitialized = true;\r\n\r\n  public shapeSize: number;\r\n  public noiseMagnitudeFactor: number;\r\n  public centerPosition: p5.Vector;\r\n  public rotationAngle: number;\r\n\r\n  private readonly vertexCount: number;\r\n  private readonly noiseDistanceScale: number;\r\n  private readonly noiseTimeScale: number;\r\n  private readonly xNoiseParameterOffset: p5.Vector;\r\n  private readonly yNoiseParameterOffset: p5.Vector;\r\n  private noiseTime: number;\r\n  private reachedEndOfScreen: boolean;\r\n\r\n  public constructor(\r\n    protected p: p5ex.p5exClass,\r\n    protected frameCounter: p5ex.NonLoopedFrameCounter,\r\n    params: {\r\n      shapeSize: number;\r\n      noiseMagnitudeFactor: number;\r\n      vertexCount?: number;\r\n      noiseDistanceScale?: number;\r\n      noiseTimeScale?: number;\r\n    }\r\n  ) {\r\n    this.shapeSize = params.shapeSize;\r\n    this.noiseMagnitudeFactor = params.noiseMagnitudeFactor;\r\n    this.centerPosition = p.createVector();\r\n    this.rotationAngle = 0;\r\n\r\n    this.vertexCount =\r\n      params.vertexCount || Math.floor(0.75 * params.shapeSize);\r\n    this.noiseDistanceScale =\r\n      params.noiseDistanceScale || params.shapeSize / 320;\r\n    this.noiseTimeScale = params.noiseTimeScale || 0.005;\r\n\r\n    this.xNoiseParameterOffset = p\r\n      .createVector(Math.random(), Math.random())\r\n      .mult(1024);\r\n    this.yNoiseParameterOffset = p\r\n      .createVector(Math.random(), Math.random())\r\n      .mult(1024);\r\n\r\n    this.noiseTime = 0;\r\n    this.reachedEndOfScreen = false;\r\n\r\n    if (RorschachShape.isNotInitialized) RorschachShape.initializeStatic(p);\r\n  }\r\n\r\n  private static initializeStatic(p: p5): void {\r\n    this.temporalVector = p.createVector();\r\n    this.isNotInitialized = false;\r\n  }\r\n\r\n  public step(): void {\r\n    this.noiseTime += this.noiseTimeScale;\r\n  }\r\n\r\n  public draw(): void {\r\n    if (this.reachedEndOfScreen) return;\r\n\r\n    this.p.translate(this.centerPosition.x, this.centerPosition.y);\r\n    this.p.rotate(this.rotationAngle);\r\n    this.drawVertices(+1);\r\n    this.drawVertices(-1);\r\n    this.p.rotate(-this.rotationAngle);\r\n    this.p.translate(-this.centerPosition.x, -this.centerPosition.y);\r\n  }\r\n\r\n  private drawVertices(yScaleFactor: number): void {\r\n    const p = this.p;\r\n    const noiseMagnitude = this.noiseMagnitudeFactor * 0.5 * this.shapeSize;\r\n    p.beginShape();\r\n\r\n    let currentBasePositionX = -0.5 * this.shapeSize;\r\n    const basePositionIntervalDistance = this.shapeSize / this.vertexCount;\r\n    const progressRatio = this.frameCounter.getProgressRatio();\r\n\r\n    for (let i = 0; i < this.vertexCount; i += 1) {\r\n      const distanceFactor =\r\n        progressRatio * p.sq(p.sin((i / this.vertexCount) * p.PI));\r\n\r\n      const noiseX =\r\n        (2 *\r\n          p.noise(\r\n            this.xNoiseParameterOffset.x +\r\n              this.noiseDistanceScale * currentBasePositionX,\r\n            this.xNoiseParameterOffset.y + this.noiseTime\r\n          ) -\r\n          1) *\r\n        noiseMagnitude;\r\n\r\n      const noiseY =\r\n        (2 *\r\n          p.noise(\r\n            this.yNoiseParameterOffset.x +\r\n              this.noiseDistanceScale * currentBasePositionX,\r\n            this.yNoiseParameterOffset.y + this.noiseTime\r\n          ) -\r\n          1) *\r\n        noiseMagnitude;\r\n\r\n      const vertexPositionX = currentBasePositionX + distanceFactor * noiseX;\r\n      const vertexPositionY =\r\n        yScaleFactor * distanceFactor * (0.3 * this.shapeSize + noiseY);\r\n      p.vertex(vertexPositionX, vertexPositionY);\r\n\r\n      const rotatedVertexPosition = RorschachShape.temporalVector;\r\n      rotatedVertexPosition.set(vertexPositionX, vertexPositionY);\r\n      rotatedVertexPosition.rotate(this.rotationAngle);\r\n      this.checkScreen(\r\n        this.centerPosition.x + rotatedVertexPosition.x,\r\n        this.centerPosition.y + rotatedVertexPosition.y\r\n      );\r\n\r\n      currentBasePositionX += basePositionIntervalDistance;\r\n    }\r\n\r\n    p.endShape();\r\n  }\r\n\r\n  private checkScreen(\r\n    absolutePositionX: number,\r\n    absolutePositionY: number\r\n  ): void {\r\n    const xMargin = 0.01 * this.p.nonScaledWidth;\r\n    const yMargin = 0.05 * this.p.nonScaledHeight;\r\n    if (\r\n      absolutePositionX < xMargin ||\r\n      absolutePositionX > this.p.nonScaledWidth - xMargin ||\r\n      absolutePositionY < yMargin ||\r\n      absolutePositionY > this.p.nonScaledHeight - yMargin\r\n    ) {\r\n      this.reachedEndOfScreen = true;\r\n    }\r\n  }\r\n}\r\n","import * as p5ex from \"p5ex\";\r\nimport { RorschachShape } from \"./RorschachShape\";\r\n\r\nconst SKETCH_NAME = \"Rorschach\";\r\n\r\nconst sketch = (p: p5ex.p5exClass): void => {\r\n  // ---- variables\r\n  const IDEAL_FRAME_RATE = 60;\r\n\r\n  let unitLength: number;\r\n\r\n  let backgroundColor: p5.Color;\r\n  let frameCounter: p5ex.NonLoopedFrameCounter;\r\n  let rorschachShape: RorschachShape;\r\n  let rorschachShapeColor: p5ex.ShapeColor;\r\n\r\n  // ---- functions\r\n  function initialize(): void {\r\n    unitLength = Math.min(p.nonScaledWidth, p.nonScaledHeight) / 640;\r\n    p.strokeWeight(Math.max(1, 1 * unitLength));\r\n\r\n    p.background(backgroundColor);\r\n\r\n    const rorschachShapeSize = 480 * unitLength;\r\n    rorschachShape = new RorschachShape(p, frameCounter, {\r\n      shapeSize: rorschachShapeSize,\r\n      vertexCount: Math.floor(1.5 * rorschachShapeSize),\r\n      noiseDistanceScale: p.random(0.005, 0.05), // random(0.3, 1.5),\r\n      noiseMagnitudeFactor: p.random(1, 4),\r\n      noiseTimeScale: 0.0005\r\n    });\r\n    rorschachShape.centerPosition.set(\r\n      0.5 * p.nonScaledWidth,\r\n      0.5 * p.nonScaledHeight\r\n    );\r\n    rorschachShape.rotationAngle = p.PI + p.HALF_PI;\r\n\r\n    rorschachShapeColor = new p5ex.ShapeColor(\r\n      p,\r\n      p.color(0, p.random(4, 48)),\r\n      null,\r\n      false\r\n    );\r\n\r\n    frameCounter.resetCount();\r\n    frameCounter.on();\r\n    p.loop();\r\n  }\r\n\r\n  // ---- Setup & Draw etc.\r\n  p.preload = () => {};\r\n\r\n  p.setup = () => {\r\n    p.createScalableCanvas(p5ex.ScalableCanvasTypes.SQUARE640x640);\r\n\r\n    p.frameRate(IDEAL_FRAME_RATE);\r\n    p.strokeJoin(p.ROUND);\r\n\r\n    backgroundColor = p.color(252);\r\n    frameCounter = new p5ex.NonLoopedFrameCounter(13 * IDEAL_FRAME_RATE, () => {\r\n      p.noLoop();\r\n    });\r\n\r\n    initialize();\r\n  };\r\n\r\n  p.draw = () => {\r\n    rorschachShape.step();\r\n\r\n    p.scalableCanvas.scale();\r\n    rorschachShapeColor.applyColor();\r\n    rorschachShape.draw();\r\n    p.scalableCanvas.cancelScale();\r\n\r\n    frameCounter.step();\r\n  };\r\n\r\n  p.mousePressed = () => {\r\n    initialize();\r\n  };\r\n\r\n  p.keyTyped = () => {\r\n    if (p.key === \"p\") p.noLoop();\r\n\r\n    if (p.keyCode === 83) p.save(\"rorschach.png\");\r\n  };\r\n};\r\n\r\nnew p5ex.p5exClass(sketch, SKETCH_NAME);\r\n"],"names":["p5ex.ShapeColor","p5ex.ScalableCanvasTypes","p5ex.NonLoopedFrameCounter","p5ex.p5exClass"],"mappings":"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"}