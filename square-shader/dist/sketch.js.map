{"version":3,"file":"sketch.js","sources":["../src/common/environment.ts","../src/main.ts"],"sourcesContent":["/**\r\n * ---- Common environment utility -------------------------------------------\r\n */\r\n\r\nimport { RectangleSize } from \"./dataTypes\";\r\n\r\n/**\r\n * Finds HTML element by `id`. If not found, returns `document.body`.\r\n * @param id\r\n */\r\nexport const getElementOrBody = (id: string): HTMLElement =>\r\n  document.getElementById(id) || document.body;\r\n\r\n/**\r\n * Returns the width and height of `node`.\r\n * If `node === document.body`, returns the inner width and height of `window`.\r\n * @param node\r\n */\r\nexport const getElementSize = (node: Element): RectangleSize =>\r\n  node === document.body\r\n    ? {\r\n        width: window.innerWidth,\r\n        height: window.innerHeight\r\n      }\r\n    : node.getBoundingClientRect();\r\n","/**\r\n * ---- Main sketch ----------------------------------------------------------\r\n */\r\n\r\nimport { getElementOrBody, getElementSize } from \"./common/environment\";\r\n\r\nconst HTML_ELEMENT = getElementOrBody(\"ShaderSquare\");\r\nconst PATH_CANDIDATES = [\r\n  \"\",\r\n  \"../assets/\",\r\n  \"https://fal-works.github.io/p5js-sketches/square-shader/assets/\"\r\n];\r\nconst GLSL_DIRECTORY_PATH = PATH_CANDIDATES[2];\r\n\r\nconst sketch = (p: p5): void => {\r\n  // ---- variables\r\n  let shaderObject: p5.Shader;\r\n  let unitLength: number;\r\n  let squarePosition: p5.Vector;\r\n\r\n  // ---- functions\r\n  const createOpaqueColorData = (c: p5.Color): number[] => [\r\n    p.red(c) / 255,\r\n    p.green(c) / 255,\r\n    p.blue(c) / 255\r\n  ];\r\n\r\n  const createCenteredRectangleData = (\r\n    centerX: number,\r\n    centerY: number,\r\n    width: number,\r\n    height: number\r\n  ): number[] => {\r\n    const x = centerX - 0.5 * width;\r\n    const y = centerY - 0.5 * height;\r\n\r\n    return [x, y, x + width, y + height];\r\n  };\r\n\r\n  function setupShader(): void {\r\n    p.shader(shaderObject);\r\n    shaderObject.setUniform(\"resolution\", [p.width, p.height]);\r\n    shaderObject.setUniform(\r\n      \"squareColor\",\r\n      createOpaqueColorData(p.color(40, 40, 48))\r\n    );\r\n  }\r\n\r\n  // ---- setup & draw etc.\r\n  p.preload = () => {\r\n    shaderObject = p.loadShader(\r\n      GLSL_DIRECTORY_PATH + \"base.vert\",\r\n      GLSL_DIRECTORY_PATH + \"square.frag\"\r\n    );\r\n  };\r\n\r\n  p.setup = () => {\r\n    const canvasSize = getElementSize(HTML_ELEMENT);\r\n    const shortSideLength = Math.min(canvasSize.width, canvasSize.height);\r\n    p.createCanvas(shortSideLength, shortSideLength, p.WEBGL);\r\n\r\n    unitLength = shortSideLength * 0.01;\r\n    squarePosition = p.createVector(0.5 * p.width, 0.5 * p.height);\r\n\r\n    setupShader();\r\n  };\r\n\r\n  p.draw = () => {\r\n    const innerSquareSize =\r\n      40 * (1 + 0.1 * Math.sin(p.frameCount * 0.05)) * unitLength;\r\n\r\n    shaderObject.setUniform(\r\n      \"innerSquare\",\r\n      createCenteredRectangleData(\r\n        squarePosition.x,\r\n        squarePosition.y,\r\n        innerSquareSize,\r\n        innerSquareSize\r\n      )\r\n    );\r\n\r\n    const outerSquareSize = innerSquareSize + 5 * unitLength;\r\n\r\n    shaderObject.setUniform(\r\n      \"outerSquare\",\r\n      createCenteredRectangleData(\r\n        squarePosition.x,\r\n        squarePosition.y,\r\n        outerSquareSize,\r\n        outerSquareSize\r\n      )\r\n    );\r\n\r\n    p.rect(0, 0, 1, 1); // Seems to be necessary but no idea what this is\r\n\r\n    // if (p.frameCount % 60 === 0) console.log(p.frameRate().toFixed(1) + \" fps\");\r\n  };\r\n\r\n  p.keyTyped = () => {\r\n    if (p.key === \"p\") p.noLoop();\r\n    if (p.key === \"s\") p.save(\"image.png\");\r\n  };\r\n};\r\n\r\nnew p5(sketch, HTML_ELEMENT);\r\n"],"names":[],"mappings":";;;;;;;;;;;;EAAA;;;EAMA;;;;AAIA,EAAO,MAAM,gBAAgB,GAAG,CAAC,EAAU,KACzC,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC;EAE/C;;;;;AAKA,EAAO,MAAM,cAAc,GAAG,CAAC,IAAa,KAC1C,IAAI,KAAK,QAAQ,CAAC,IAAI;QAClB;UACE,KAAK,EAAE,MAAM,CAAC,UAAU;UACxB,MAAM,EAAE,MAAM,CAAC,WAAW;OAC3B;QACD,IAAI,CAAC,qBAAqB,EAAE,CAAC;;ECxBnC;;;AAIA,EAEA,MAAM,YAAY,GAAG,gBAAgB,CAAC,cAAc,CAAC,CAAC;EACtD,MAAM,eAAe,GAAG;MACtB,EAAE;MACF,YAAY;MACZ,iEAAiE;GAClE,CAAC;EACF,MAAM,mBAAmB,GAAG,eAAe,CAAC,CAAC,CAAC,CAAC;EAE/C,MAAM,MAAM,GAAG,CAAC,CAAK;;MAEnB,IAAI,YAAuB,CAAC;MAC5B,IAAI,UAAkB,CAAC;MACvB,IAAI,cAAyB,CAAC;;MAG9B,MAAM,qBAAqB,GAAG,CAAC,CAAW,KAAe;UACvD,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG;UACd,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,GAAG;UAChB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG;OAChB,CAAC;MAEF,MAAM,2BAA2B,GAAG,CAClC,OAAe,EACf,OAAe,EACf,KAAa,EACb,MAAc;UAEd,MAAM,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,KAAK,CAAC;UAChC,MAAM,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,MAAM,CAAC;UAEjC,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC;OACtC,CAAC;MAEF,SAAS,WAAW;UAClB,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;UACvB,YAAY,CAAC,UAAU,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;UAC3D,YAAY,CAAC,UAAU,CACrB,aAAa,EACb,qBAAqB,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAC3C,CAAC;OACH;;MAGD,CAAC,CAAC,OAAO,GAAG;UACV,YAAY,GAAG,CAAC,CAAC,UAAU,CACzB,mBAAmB,GAAG,WAAW,EACjC,mBAAmB,GAAG,aAAa,CACpC,CAAC;OACH,CAAC;MAEF,CAAC,CAAC,KAAK,GAAG;UACR,MAAM,UAAU,GAAG,cAAc,CAAC,YAAY,CAAC,CAAC;UAChD,MAAM,eAAe,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;UACtE,CAAC,CAAC,YAAY,CAAC,eAAe,EAAE,eAAe,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;UAE1D,UAAU,GAAG,eAAe,GAAG,IAAI,CAAC;UACpC,cAAc,GAAG,CAAC,CAAC,YAAY,CAAC,GAAG,GAAG,CAAC,CAAC,KAAK,EAAE,GAAG,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC;UAE/D,WAAW,EAAE,CAAC;OACf,CAAC;MAEF,CAAC,CAAC,IAAI,GAAG;UACP,MAAM,eAAe,GACnB,EAAE,IAAI,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,GAAG,UAAU,CAAC;UAE9D,YAAY,CAAC,UAAU,CACrB,aAAa,EACb,2BAA2B,CACzB,cAAc,CAAC,CAAC,EAChB,cAAc,CAAC,CAAC,EAChB,eAAe,EACf,eAAe,CAChB,CACF,CAAC;UAEF,MAAM,eAAe,GAAG,eAAe,GAAG,CAAC,GAAG,UAAU,CAAC;UAEzD,YAAY,CAAC,UAAU,CACrB,aAAa,EACb,2BAA2B,CACzB,cAAc,CAAC,CAAC,EAChB,cAAc,CAAC,CAAC,EAChB,eAAe,EACf,eAAe,CAChB,CACF,CAAC;UAEF,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;;OAGpB,CAAC;MAEF,CAAC,CAAC,QAAQ,GAAG;UACX,IAAI,CAAC,CAAC,GAAG,KAAK,GAAG;cAAE,CAAC,CAAC,MAAM,EAAE,CAAC;UAC9B,IAAI,CAAC,CAAC,GAAG,KAAK,GAAG;cAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;OACxC,CAAC;EACJ,CAAC,CAAC;EAEF,IAAI,EAAE,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;;;;"}